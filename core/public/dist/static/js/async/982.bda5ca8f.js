"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["982"],{6471:function(e,t,a){a.d(t,{Z:()=>p});var l=a(2510),r=a(1792),i=a(5266),o=a(3073),s=a(7737),n=a(4339),u=a(8168),c=a(3754),d=Object.prototype.hasOwnProperty;let p=function(e){if(null==e)return!0;if((0,s.Z)(e)&&((0,o.Z)(e)||"string"==typeof e||"function"==typeof e.splice||(0,n.Z)(e)||(0,c.Z)(e)||(0,i.Z)(e)))return!e.length;var t=(0,r.Z)(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if((0,u.Z)(e))return!(0,l.Z)(e).length;for(var a in e)if(d.call(e,a))return!1;return!0}},2822:function(e,t,a){a.d(t,{Z:()=>i});var l=a(1452),r=a(2398);let i=function(e){return"number"==typeof e||(0,r.Z)(e)&&"[object Number]"==(0,l.Z)(e)}},7714:function(e,t,a){a.d(t,{Z:()=>g});var l=a(5083),r=a(209),i=a(1321),o=a(4124),s=a(2931),n=a(2249),u=a(6253),c=a(3876),d=a(8713);let p={name:"Flex",self:function(){return d.Z}},m=Object.assign(Object.assign({},i.Z.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrap:{type:Boolean,default:!0}}),g=(0,r.aZ)({name:"Flex",props:m,setup(e){let{mergedClsPrefixRef:t,mergedRtlRef:a}=(0,o.ZP)(e),u=(0,i.Z)("Flex","-flex",void 0,p,e,t);return{rtlEnabled:(0,s.V)("Flex",a,t),mergedClsPrefix:t,margin:(0,r.Fl)(()=>{let{size:t}=e;if(Array.isArray(t))return{horizontal:t[0],vertical:t[1]};if("number"==typeof t)return{horizontal:t,vertical:t};let{self:{[(0,n.Tl)("gap",t)]:a}}=u.value,{row:r,col:i}=(0,l.yU)(a);return{horizontal:(0,l.fQ)(i),vertical:(0,l.fQ)(r)}})}},render(){let{vertical:e,reverse:t,align:a,inline:l,justify:i,margin:o,wrap:s,mergedClsPrefix:n,rtlEnabled:d}=this,p=(0,u.x)((0,c.z)(this),!1);return p.length?(0,r.h)("div",{role:"none",class:[`${n}-flex`,d&&`${n}-flex--rtl`],style:{display:l?"inline-flex":"flex",flexDirection:e&&!t?"column":e&&t?"column-reverse":!e&&t?"row-reverse":"row",justifyContent:i,flexWrap:!s||e?"nowrap":"wrap",alignItems:a,gap:`${o.vertical}px ${o.horizontal}px`}},p):null}})},8943:function(e,t,a){a.d(t,{Z:()=>o});var l=a(209),r=a(8282),i=a(8842);let o=(0,l.aZ)({name:"RadioButton",props:i.xu,setup:i.cY,render(){let{mergedClsPrefix:e}=this;return(0,l.h)("label",{class:[`${e}-radio-button`,this.mergedDisabled&&`${e}-radio-button--disabled`,this.renderSafeChecked&&`${e}-radio-button--checked`,this.focus&&[`${e}-radio-button--focus`]]},(0,l.h)("input",{ref:"inputRef",type:"radio",class:`${e}-radio-input`,value:this.value,name:this.mergedName,checked:this.renderSafeChecked,disabled:this.mergedDisabled,onChange:this.handleRadioInputChange,onFocus:this.handleRadioInputFocus,onBlur:this.handleRadioInputBlur}),(0,l.h)("div",{class:`${e}-radio-button__state-border`}),(0,r.K9)(this.$slots.default,t=>t||this.label?(0,l.h)("div",{ref:"labelRef",class:`${e}-radio__label`},t||this.label):null))}})},1625:function(e,t,a){a.d(t,{WH:()=>o,hI:()=>i,iE:()=>u,mD:()=>n,sS:()=>s,vi:()=>c});var l=a(4203);let{t:r}=a(4958).Z.global,i=e=>l.e.get("/contact/group/list",{params:e}),o=()=>l.e.get("/contact/group/all"),s=e=>l.e.post("/contact/group/create",e,{fetchOptions:{loading:r("contacts.group.loading.createGroup"),successMessage:!0}}),n=e=>l.e.post("/contact/group/update",e,{fetchOptions:{loading:r("contacts.group.loading.updateGroup"),successMessage:!0}}),u=e=>l.e.post("/contact/group/delete",e,{fetchOptions:{loading:r("contacts.group.loading.deleteGroup"),successMessage:!0}}),c=e=>l.e.post("/contact/group/contact_count",e)},7882:function(e,t,a){a.r(t),a.d(t,{default:()=>G});var l=a(4652),r=a(6818),i=a(3435),o=a(2748),s=a(2171),n=a(8943),u=a(209),c=a(4059),d=a(7714),p=a(3447),m=a(3312),g=a(6949),f=a(2965),v=a(4203);let{t:b}=a(4958).Z.global,_=e=>v.e.get("/contact/list",{params:e}),h=e=>v.e.post("/contact/group/import",e,{fetchOptions:{loading:b("contacts.group.loading.importSubscribers"),successMessage:!0}}),S=e=>v.e.post("/contact/update_group",e,{fetchOptions:{loading:b("contacts.group.loading.updateSubscriberGroup"),successMessage:!0}}),U=e=>v.e.post("/contact/delete",e,{fetchOptions:{loading:b("contacts.group.loading.deleteSubscriber"),successMessage:!0}});var w=a(5891),y=a(1625),Z=a(5778);let x=(0,u.aZ)({__name:"GroupSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let{t}=(0,Z.QT)(),a=(0,u.tT)(e,"value"),l=(0,u.iH)([{label:t("common.all.text"),value:""}]),r=e=>{let{option:a}=e;return`${t("contacts.subscribers.select.prefix")}${a.label}`};return(async()=>{let e=await (0,y.WH)();(0,f.Kn)(e)&&(l.value=e.list.map(e=>({label:e.name,value:e.id})),l.value.unshift({label:t("common.all.text"),value:""}))})(),(e,t)=>{let i=w.Z;return(0,u.wg)(),(0,u.j4)(i,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:(0,u.SU)(l),renderTag:r},null,8,["value","options"])}}});var W=a(3951),k=a(6714),$=a(8454),j=a(6883),z=a(6471);let R=(0,u.aZ)({__name:"GroupMultipleSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let t=(0,u.tT)(e,"value"),a=(0,u.iH)([]),l=(0,u.iH)(!1);return(async()=>{try{l.value=!0;let e=await (0,y.WH)();(0,f.Kn)(e)&&(a.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{l.value=!1}})(),(e,r)=>{let i=w.Z;return(0,u.wg)(),(0,u.j4)(i,{value:t.value,"onUpdate:value":r[0]||(r[0]=e=>t.value=e),"max-tag-count":"responsive",multiple:!0,filterable:!0,loading:(0,u.SU)(l),options:(0,u.SU)(a)},null,8,["value","loading","options"])}}});var C=a(5822);let O={class:"pt-12px"},P={class:"flex-1"},T={class:"mt-12px"},M={class:"mt-16px text-12px text-desc"},F=(0,u.aZ)({__name:"SubscriberImport",setup(e){let{t}=(0,Z.QT)(),a=(0,u.AE)("formRef"),l=(0,u.iH)("paste"),r=(0,u.qj)({group_ids:[],import_type:2,contacts:"",file_data:"",file_type:""}),i={group_ids:{trigger:"change",validator:()=>0!==r.group_ids.length||Error(t("contacts.subscribers.import.validation.groupRequired"))},contacts:{trigger:["input","blur"],validator:()=>!(2===r.import_type&&(0,z.Z)(r.contacts))||Error(t("contacts.subscribers.import.validation.dataRequired"))}},o=e=>{let t=new FileReader;t.onload=t=>{var a;r.file_type=e.name.substring(e.name.lastIndexOf(".")+1),r.file_data=null===(a=t.target)||void 0===a?void 0:a.result},e.file&&t.readAsText(e.file)},c=async()=>{await (0,C.Sv)({file_path:"/opt/Billion-Mail/data/example_recipients.txt"})},d=async()=>{var e;if(await (null===(e=a.value)||void 0===e?void 0:e.validate()),"upload"===l.value&&(0,z.Z)(r.file_data))return f.v0.error(t("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[g,v]=(0,m.d)({onChangeState:e=>{if(e){let e=v.getState();(null==e?void 0:e.group_id)?r.group_ids=[e.group_id]:r.group_ids=[],r.import_type=2,r.contacts="",r.file_data="",r.file_type=""}},onConfirm:async()=>{await d(),await h((0,u.IU)(r));let e=v.getState();null==e||e.refresh()}});return(e,t)=>{let l=j.ZP,d=n.Z,m=s.Z,f=$.Z,v=k.Z,b=p.ZP,_=W.Z;return(0,u.wg)(),(0,u.j4)((0,u.SU)(g),{title:e.$t("contacts.subscribers.import.title"),width:"500"},{default:(0,u.w5)(()=>[(0,u._)("div",O,[(0,u.Wm)(_,{ref_key:"formRef",ref:a,model:(0,u.SU)(r),rules:i},{default:(0,u.w5)(()=>[(0,u.Wm)(l,{label:e.$t("contacts.subscribers.import.group"),path:"group_id"},{default:(0,u.w5)(()=>[(0,u.Wm)(R,{value:(0,u.SU)(r).group_ids,"onUpdate:value":t[0]||(t[0]=e=>(0,u.SU)(r).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,u.Wm)(l,{label:e.$t("contacts.subscribers.import.data"),path:"contacts"},{default:(0,u.w5)(()=>[(0,u._)("div",P,[(0,u.Wm)(m,{value:(0,u.SU)(r).import_type,"onUpdate:value":t[1]||(t[1]=e=>(0,u.SU)(r).import_type=e)},{default:(0,u.w5)(()=>[(0,u.Wm)(d,{value:2},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("contacts.subscribers.import.pasteData")),1)]),_:1}),(0,u.Wm)(d,{value:1},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("contacts.subscribers.import.uploadFile")),1)]),_:1})]),_:1},8,["value"]),(0,u._)("div",T,[2===(0,u.SU)(r).import_type?((0,u.wg)(),(0,u.j4)(f,{key:0,value:(0,u.SU)(r).contacts,"onUpdate:value":t[2]||(t[2]=e=>(0,u.SU)(r).contacts=e),type:"textarea",rows:8,placeholder:e.$t("contacts.subscribers.import.pastePlaceholder")},null,8,["value","placeholder"])):1===(0,u.SU)(r).import_type?((0,u.wg)(),(0,u.iD)(u.HY,{key:1},[(0,u.Wm)(v,{"is-upload":!1,accept:["txt"],onChange:o}),(0,u._)("div",M,[(0,u.Uk)((0,u.zw)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,u.Wm)(b,{text:"",type:"primary",onClick:c},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("common.actions.download")),1)]),_:1})])],64)):(0,u.kq)("",!0)])])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var H=a(5115);let I=(0,H.default)(F,[["__scopeId","data-v-7a7e776e"]]),q={class:"pt-12px"},A=(0,u.aZ)({__name:"SubscriberEdit",setup(e){let{t}=(0,Z.QT)(),a=(0,u.AE)("formRef"),l=(0,u.qj)({email:"",status:1,group_ids:[]}),r={email:{required:!0,message:t("contacts.subscribers.edit.validation.emailRequired"),trigger:"blur"},group_ids:{trigger:"change",validator:()=>0!==l.group_ids.length||Error(t("contacts.subscribers.edit.validation.groupRequired"))}},[i,o]=(0,m.d)({onChangeState:e=>{if(e){let{row:e}=o.getState();e&&(l.email=e.email,l.status=e.active,l.group_ids=e.groups.map(e=>e.id))}else l.email="",l.status=1,l.group_ids=[]},onConfirm:async()=>{var e;await (null===(e=a.value)||void 0===e?void 0:e.validate()),await S({emails:[l.email],group_ids:l.group_ids,status:l.status}),o.getState().refresh()}});return(e,t)=>{let o=$.Z,s=j.ZP,n=W.Z;return(0,u.wg)(),(0,u.j4)((0,u.SU)(i),{title:e.$t("contacts.subscribers.edit.title"),width:"440"},{default:(0,u.w5)(()=>[(0,u._)("div",q,[(0,u.Wm)(n,{ref_key:"formRef",ref:a,model:(0,u.SU)(l),rules:r},{default:(0,u.w5)(()=>[(0,u.Wm)(s,{label:e.$t("contacts.subscribers.edit.email"),path:"email"},{default:(0,u.w5)(()=>[(0,u.Wm)(o,{value:(0,u.SU)(l).email,"onUpdate:value":t[0]||(t[0]=e=>(0,u.SU)(l).email=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,u.Wm)(s,{label:e.$t("contacts.subscribers.edit.group"),path:"group_ids"},{default:(0,u.w5)(()=>[(0,u.Wm)(R,{value:(0,u.SU)(l).group_ids,"onUpdate:value":t[1]||(t[1]=e=>(0,u.SU)(l).group_ids=e)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}}),B={class:"w-200px"};function D(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,u.lA)(e)}let E=(0,u.aZ)({__name:"index",setup(e){let{t}=(0,Z.QT)(),a=(0,c.tLD)(),{tableParams:v,tableList:b,loading:h,tableTotal:S,getTableData:w}=(0,g.Z)({loading:!0,immediate:!0,params:{page:1,page_size:10,group_id:a.value.state.group_id||"",keyword:"",status:1},fetchFn:_}),y=(0,u.iH)([{key:"email",title:t("contacts.subscribers.columns.email"),minWidth:120,ellipsis:{tooltip:!0}},{key:"groups",title:t("contacts.subscribers.columns.name"),minWidth:100,render:e=>e.groups.map(e=>e.name).join(", ")},{key:"create_time",title:t("contacts.subscribers.columns.createdAt"),minWidth:140,render:e=>(0,f.mr)(e.create_time)},{title:t("common.columns.actions"),key:"actions",align:"right",width:180,render:e=>{let a,l;return(0,u.Wm)(d.Z,{inline:!0},{default:()=>[(0,u.Wm)(p.ZP,{type:"primary",text:!0,onClick:()=>{R(e)}},D(a=t("contacts.subscribers.actions.changeGroup"))?a:{default:()=>[a]}),(0,u.Wm)(p.ZP,{type:"error",text:!0,onClick:()=>{C(e)}},D(l=t("common.actions.delete"))?l:{default:()=>[l]})]})}}]),[W,k]=(0,m.d)({component:I,state:{refresh:w}}),$=()=>{k.setState({group_id:v.value.group_id}),k.open()},[j,z]=(0,m.d)({component:A,state:{refresh:w}}),R=e=>{z.setState({row:e}),z.open()},C=e=>{(0,f.iG)({title:t("contacts.subscribers.delete.title"),content:t("contacts.subscribers.delete.confirm",{email:e.email}),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await U({emails:[e.email],status:v.value.status}),w()}})};return(e,a)=>{let c=n.Z,d=s.Z,m=o.Z,g=i.Z,f=r.Z,_=l.Z;return(0,u.wg)(),(0,u.iD)("div",null,[(0,u.Wm)(_,null,{toolsLeft:(0,u.w5)(()=>[(0,u.Wm)((0,u.SU)(p.ZP),{type:"primary",onClick:$},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)((0,u.SU)(t)("common.actions.import")),1)]),_:1})]),toolsRight:(0,u.w5)(()=>[(0,u.Wm)(d,{value:(0,u.SU)(v).status,"onUpdate:value":[a[0]||(a[0]=e=>(0,u.SU)(v).status=e),a[1]||(a[1]=()=>(0,u.SU)(w)(!0))]},{default:(0,u.w5)(()=>[(0,u.Wm)(c,{value:1},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)((0,u.SU)(t)("contacts.subscribers.status.subscribed")),1)]),_:1}),(0,u.Wm)(c,{value:0},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)((0,u.SU)(t)("contacts.subscribers.status.unsubscribed")),1)]),_:1})]),_:1},8,["value"]),(0,u._)("div",B,[(0,u.Wm)(x,{value:(0,u.SU)(v).group_id,"onUpdate:value":[a[2]||(a[2]=e=>(0,u.SU)(v).group_id=e),a[3]||(a[3]=()=>(0,u.SU)(w)(!0))]},null,8,["value"])]),(0,u.Wm)(m,{value:(0,u.SU)(v).keyword,"onUpdate:value":a[4]||(a[4]=e=>(0,u.SU)(v).keyword=e),width:240,placeholder:(0,u.SU)(t)("contacts.subscribers.search.emailPlaceholder"),onSearch:a[5]||(a[5]=()=>(0,u.SU)(w)(!0))},null,8,["value","placeholder"])]),table:(0,u.w5)(()=>[(0,u.Wm)(g,{loading:(0,u.SU)(h),columns:(0,u.SU)(y),data:(0,u.SU)(b)},null,8,["loading","columns","data"])]),pageRight:(0,u.w5)(()=>[(0,u.Wm)(f,{page:(0,u.SU)(v).page,"onUpdate:page":a[6]||(a[6]=e=>(0,u.SU)(v).page=e),"page-size":(0,u.SU)(v).page_size,"onUpdate:pageSize":a[7]||(a[7]=e=>(0,u.SU)(v).page_size=e),"item-count":(0,u.SU)(S),onRefresh:(0,u.SU)(w)},null,8,["page","page-size","item-count","onRefresh"])]),modal:(0,u.w5)(()=>[(0,u.Wm)((0,u.SU)(W)),(0,u.Wm)((0,u.SU)(j))]),_:1})])}}}),G=(0,H.default)(E,[["__scopeId","data-v-abb1702c"]])}}]);