"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["9234"],{81208:function(e,t,a){a.d(t,{A8:()=>o,NI:()=>s,QB:()=>r,WF:()=>u,Xc:()=>c,ef:()=>d});var l=a(77527),n=a(86244);let{t:i}=l.Z.global;function o(e){return n.e.get("/email_template/list",{params:e})}function s(){return n.e.get("/email_template/all")}function u(e){return n.e.post("/email_template/create",e,{fetchOptions:{loading:i("market.template.loading.creating"),successMessage:!0}})}function r(e){return n.e.post("/email_template/update",e,{fetchOptions:{loading:i("market.template.loading.updating"),successMessage:!0}})}function d(e){return n.e.post("/email_template/copy",e,{fetchOptions:{loading:i("market.template.loading.copying"),successMessage:!0}})}function c(e){return n.e.post("/email_template/delete",e,{fetchOptions:{loading:i("market.template.loading.deleting"),successMessage:!0}})}},69288:function(e,t,a){a.d(t,{DP:()=>_,Ew:()=>d,I5:()=>m,JI:()=>h,L3:()=>r,Nh:()=>y,UY:()=>g,WJ:()=>f,nn:()=>w});var l=a(77527),n=a(86244),i=a(25595);let{t:o}=l.Z.global,s={fetchOptions:{loading:o("template.ai.loading.message"),successMessage:!0}};async function u(e,t){try{await n.e.post("/email_template/create",{temp_name:t,add_type:2,chat_id:e,html_content:""})}catch(e){throw console.warn(e),e}}async function r(e){await c(e),await p(e)}async function d(e){try{let t=`AI_temp_${new Date().getTime()}`,a=await n.e.post("/askai/chat/create_chat",{domain:e,add_type:99,temp_name:t},s);return await u(a.chatId,t),a.chatId}catch(e){return console.warn(e),null}}async function c(e){let{modelList:t,currentModel:a,currentModelTitle:l}=e;try{t.value=await n.e.post("/askai/supplier/models"),t.value.length&&(a.value=t.value[0],l.value=t.value[0].title)}catch(e){console.warn(e)}}async function p(e){let{chatId:t,chatInfo:a,currentModel:l,modelList:i,currentModelTitle:o,chatRecord:s}=e;try{if(a.value=await n.e.post("/askai/chat/info",{chatId:t.value}),a.value.modelId&&i.value.length){let e=i.value.find(e=>e.modelId==a.value.modelId);e&&(l.value=e,o.value=e.title)}for(let e=0;e<a.value.messages.length;e++)"user"==a.value.messages[e].role&&s.value.set(`${a.value.messages[e].content}_+_${s.value.size}`,v(a.value.messages[e+1].content))}catch(e){console.warn(e)}}async function m(e){let{chatId:t,isChat:a}=e;try{await n.e.post("/askai/chat/stop",{chatId:t.value},s),a.value=!1}catch(e){console.warn(e)}}async function f(e){let{scrollable:t,generateShow:a,chatId:l,currentModel:o,questionContent:s,chatRecord:u,currentChatRecordKey:r,scrollWrapperRef:d,chatScrollRef:c,isChat:p}=e;if(p.value)return;let m=`${s.value}_+_${u.value.size}`;u.value.set(m,[]),r.value=m;let f=s.value;s.value="";let h=[],g="",_=0;try{t.value=!0,a.value=!0,p.value=!0,(0,i.Y3)(()=>c.value.scrollTo({left:0,top:d.value.offsetHeight})),await n.e.post("/askai/chat/chat",{chatId:l.value,supplierName:o.value.supplierName,modelId:o.value.modelId,content:f,is_text:"false"},{fetchOptions:{cancelResInterceptor:!0},responseType:"text",onDownloadProgress:e=>{a.value=!1;try{let a=e.event.target.responseText,n=a.slice(_);_=a.length;var l=function(e){let t=e.split("\n"),a=[];for(let e of t){let t=e.trim();if(t.startsWith("data:")){let e=t.slice(5).trim();e&&a.push(e)}}return a}(n);for(let e=0;e<l.length;e++)l[e]&&(g+=JSON.parse(l[e]).content);u.value.set(m,v(g)),t.value&&setTimeout(()=>c.value.scrollTo({left:0,top:d.value.offsetHeight}),200)}catch(e){console.warn(e)}}}),t.value=!0,c.value.scrollTo({left:0,top:d.value.offsetHeight}),p.value=!1,y(e)}catch(e){console.warn(e)}finally{a.value=!1,g="",_=0}}function v(e){let t=/```[\s\S]*?(?:```|$)/g,a=e.match(t)||[],l=e.split(t),n=[],i=Math.max(l.length,a.length);for(let e=0;e<i;e++)e<l.length&&""!==l[e].trim()&&n.push(l[e]),e<a.length&&n.push(a[e]);return n}function h(e){return e.replace(/```html/g,"").replace(/```$/gm,"")}function g(e){return e.replace(/<<<<<<<\s+SEARCH[\s\S]*?=======([\s\S]*?)>>>>>>>\s+REPLACE/g,"$1")}function _(e){let t=e.match(/<title>(.*?)<\/title>/i);return t?t[1]:""}async function y(e){let{chatId:t,previewCode:a,previewTit:l}=e;try{a.value=await n.e.post("/askai/chat/get_html",{chatId:t.value}),l.value=_(a.value)}catch(e){console.warn(e)}}async function w(e){let{previewCode:t,chatId:a}=e;try{await n.e.post("/askai/chat/modify_html",{chatId:a.value,content:t.value},s)}catch(e){console.warn(e)}}},66560:function(e,t,a){a.d(t,{Z:()=>s});var l=a(20993),n=a(25595),i=a(53217);let o=(0,n.aZ)({__name:"index",props:(0,n.Vf)({language:{type:String,default:"html"},theme:{type:String,default:"vs-dark"},options:{type:Object,default:()=>({})}},{value:{default:""},valueModifiers:{}}),emits:(0,n.Vf)(["save"],["update:value"]),setup(e,t){let{expose:a,emit:o}=t,s=(0,n.tT)(e,"value"),u=(0,n.iH)(null),r=null,d=(0,n.iH)(!1);i.Z.config({paths:{vs:`${location.origin}/static/plugin/monaco`}});let c=async()=>{if(u.value&&!r)try{d.value=!0;let t=await i.Z.init();(r=t.editor.create(u.value,{value:s.value,language:e.language,theme:e.theme,minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,fontSize:14,tabSize:2,wordWrap:"on",...e.options})).onDidChangeModelContent(()=>{s.value=(null==r?void 0:r.getValue())||""}),r.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KeyS,function(){o("save")})}finally{d.value=!1}},p=()=>{r&&(r.dispose(),r=null)};return(0,n.YP)(()=>s.value,e=>{r&&e!==r.getValue()&&r.setValue(e)}),(0,n.bv)(()=>{c()}),(0,n.Jd)(()=>{p()}),a({getEditor:()=>r}),(e,t)=>{let a=l.Z;return(0,n.wg)(),(0,n.j4)(a,{class:"h-full",show:(0,n.SU)(d)},{default:(0,n.w5)(()=>[(0,n._)("div",{ref_key:"containerRef",ref:u,class:"monaco-editor-container"},null,512)]),_:1},8,["show"])}}}),s=(0,a(83744).default)(o,[["__scopeId","data-v-72ffe419"]])},59147:function(e,t,a){a.d(t,{Z:()=>i});var l=a(25595);let n=["height","srcdoc"],i=(0,l.aZ)({__name:"index",props:{value:{type:String,default:""},height:{type:[String,Number],default:"100%"}},setup:e=>(t,a)=>((0,l.wg)(),(0,l.iD)("iframe",{width:"100%",height:e.height,srcdoc:e.value,style:{border:"none",borderRadius:"4px"}},null,8,n))})},82646:function(e,t,a){a.d(t,{Z:()=>i});var l=a(85068),n=a(25595);let i=(0,n.aZ)({__name:"index",props:(0,n.Vf)({width:{default:240},prefix:{type:Boolean,default:!1}},{value:{default:""},valueModifiers:{}}),emits:(0,n.Vf)(["search"],["update:value"]),setup(e,t){let{expose:a,emit:i}=t,o=(0,n.iH)(null),s=(0,n.tT)(e,"value"),u=()=>{i("search",s.value)};return a({focus:()=>{var e;null==(e=o.value)||e.focus()}}),(e,t)=>{let a=l.Z;return(0,n.wg)(),(0,n.j4)(a,(0,n.dG)({ref_key:"inputRef",ref:o,value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e)},e.$attrs,{class:"bt-search",style:{width:`${e.width}px`},onKeyup:(0,n.D2)(u,["enter"])}),(0,n.Nv)({_:2},[e.prefix?{name:"prefix",fn:(0,n.w5)(()=>[(0,n._)("div",{class:"flex items-center cursor-pointer",onClick:u},t[1]||(t[1]=[(0,n._)("i",{class:"i-mdi-search text-16px"},null,-1)]))]),key:"0"}:void 0,e.prefix?void 0:{name:"suffix",fn:(0,n.w5)(()=>[(0,n._)("div",{class:"flex items-center cursor-pointer",onClick:u},t[2]||(t[2]=[(0,n._)("i",{class:"i-mdi-search text-16px"},null,-1)]))]),key:"1"}]),1040,["value","style"])}}})},88507:function(e,t,a){a.r(t),a.d(t,{default:()=>K});var l=a(25322),n=a(80837),i=a(38322),o=a(22851),s=a(82646),u=a(25595),r=a(99833),d=a(17127),c=a(44971),p=a(16821),m=a(3449),f=a(43407),v=a(81208),h=a(21921),g=a(34909),_=a(66560),y=a(41074),w=a(61950),S=a(46126),U=a(28459),k=a(85068);let Z={class:"flex flex-col flex-1 h-580px"},x={class:"flex justify-end gap-12px mb-8px"},b={class:"flex-1"},W=(0,u.aZ)({__name:"TemplateForm",setup(e){let t=(0,u.RC)(()=>Promise.all([a.e("1067"),a.e("3855"),a.e("9250"),a.e("7340"),a.e("4416")]).then(a.bind(a,54879))),l=(0,u.iH)(!1),n=(0,u.Fl)(()=>l.value?"Edit template":"New template"),i=(0,u.iH)(0),o=(0,u.qj)({temp_name:"",add_type:0,html_content:"",drag_data:""}),s=[{label:"HTML",value:0},{label:"Drag",value:1}],d=(0,u.Fl)(()=>{var e;return(null==(e=s.find(e=>e.value===o.add_type))?void 0:e.label)||""}),c=e=>{let t=new FileReader;t.onload=e=>{var t;o.html_content=null==(t=e.target)?void 0:t.result},e.file&&t.readAsText(e.file)},m=()=>{let e=W.getState();e.preview&&e.preview(o.html_content)},[f,W]=(0,p.d)({onChangeState:e=>{if(e){let e=W.getState(),{row:t}=e;l.value=e.isEdit,e.type&&(o.add_type=e.type),t&&(i.value=t.id,o.temp_name=t.temp_name,o.add_type=t.add_type,o.html_content=t.html_content,o.drag_data=t.drag_data)}else i.value=0,o.temp_name="",o.add_type=0,o.html_content="",o.drag_data=""},onConfirm:async()=>{l.value?await (0,v.QB)({id:i.value,...(0,u.IU)(o)}):await (0,v.WF)((0,u.IU)(o)),W.getState().refresh()}});return(e,a)=>{let i=k.Z,p=U.ZP,v=S.Z,W=w.Z,C=y.Z,I=r.ZP,T=_.Z,H=g.ZP,P=h.Z;return(0,u.wg)(),(0,u.j4)((0,u.SU)(f),{title:(0,u.SU)(n),width:1200},{default:(0,u.w5)(()=>[(0,u.Wm)(P,{class:"pt-8px",model:(0,u.SU)(o)},{default:(0,u.w5)(()=>[(0,u.Wm)(W,{cols:24,"x-gap":24},{default:(0,u.w5)(()=>[(0,u.Wm)(p,{span:18,label:"Name",path:"temp_name"},{default:(0,u.w5)(()=>[(0,u.Wm)(i,{value:(0,u.SU)(o).temp_name,"onUpdate:value":a[0]||(a[0]=e=>(0,u.SU)(o).temp_name=e),placeholder:e.$t("market.template.add.namePlaceholder")},null,8,["value","placeholder"])]),_:1}),(0,u.Wm)(p,{span:6,label:"Type",path:"add_type"},{default:(0,u.w5)(()=>[(0,u.Wm)(v,{value:(0,u.SU)(o).add_type,"onUpdate:value":a[1]||(a[1]=e=>(0,u.SU)(o).add_type=e),disabled:(0,u.SU)(l),options:s},null,8,["value","disabled"])]),_:1})]),_:1}),(0,u.Wm)(H,{label:(0,u.SU)(d),"show-feedback":!1},{default:(0,u.w5)(()=>[(0,u._)("div",Z,[(0,u._)("div",x,[(0,u._)("div",null,[(0,u.Wm)(C,{mode:"button","button-type":"primary","is-upload":!1,accept:["html"],onChange:c},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("market.template.uploadHtml")),1)]),_:1})]),(0,u.Wm)(I,{type:"primary",ghost:"",onClick:m},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("common.actions.preview")),1)]),_:1})]),(0,u._)("div",b,[1===(0,u.SU)(o).add_type?((0,u.wg)(),(0,u.j4)((0,u.SU)(t),{key:0,config:(0,u.SU)(o).drag_data,"onUpdate:config":a[2]||(a[2]=e=>(0,u.SU)(o).drag_data=e),html:(0,u.SU)(o).html_content,"onUpdate:html":a[3]||(a[3]=e=>(0,u.SU)(o).html_content=e)},null,8,["config","html"])):(0,u.kq)("",!0),0===(0,u.SU)(o).add_type?((0,u.wg)(),(0,u.j4)(T,{key:1,value:(0,u.SU)(o).html_content,"onUpdate:value":a[4]||(a[4]=e=>(0,u.SU)(o).html_content=e),language:"html"},null,8,["value"])):(0,u.kq)("",!0)])])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])}}});var C=a(59147);let I=(0,u.aZ)({__name:"TemplatePreview",setup(e){let t=(0,u.iH)(""),[a,l]=(0,p.d)({onChangeState:e=>{e&&(t.value=l.getState().html||"")}});return(e,l)=>{let n=C.Z;return(0,u.wg)(),(0,u.j4)((0,u.SU)(a),{title:e.$t("market.template.preview.title"),width:"820",footer:!1},{default:(0,u.w5)(()=>[(0,u.Wm)(n,{height:580,value:(0,u.SU)(t)},null,8,["value"])]),_:1},8,["title"])}}});var T=a(24950),H=a(86244),P=a(69288),z=a(86695),M=a(29938);let $={class:"wrapper"},j={class:"creation-methods"},A=["onClick"],D={class:"item-label"},R={class:"flex justify-end"},E=(0,u.aZ)({__name:"CreateTplModal",emits:["confirmType"],setup(e,t){let{expose:a,emit:l}=t,n=(0,z.s6)(),i=(0,M.tv)(),o=(0,u.iH)(["Drag","AI","HTML"]),s=(0,u.iH)("AI"),d=(0,u.iH)(""),c=(0,u.iH)(!1),p=(0,u.iH)([]);async function m(){if("AI"==s.value){let e=await (0,P.Ew)(d.value);e&&(n.domainSource=d.value,i.push({name:"ai-template",params:{chatId:e}}))}else l("confirmType",s.value)}return a({open:function(){c.value=!0},close:function(){c.value=!1}}),async function(){p.value=(await H.e.get("/domains/list",{params:{page:1,page_size:100}})).list,n.domainSource?d.value=n.domainSource:d.value=p.value[0].domain}(),(e,t)=>{let a=S.Z,l=r.ZP,n=T.Z;return(0,u.wg)(),(0,u.j4)(n,{show:(0,u.SU)(c),"onUpdate:show":t[1]||(t[1]=e=>(0,u.dq)(c)?c.value=e:null),preset:"card",draggable:"","close-on-esc":!1,"mask-closable":!1,segmented:"",class:"w-110",title:""},{footer:(0,u.w5)(()=>[(0,u._)("div",R,[(0,u.Wm)(l,{type:"primary",onClick:m},{default:(0,u.w5)(()=>t[4]||(t[4]=[(0,u.Uk)("Create")])),_:1,__:[4]})])]),default:(0,u.w5)(()=>[(0,u._)("div",$,[(0,u._)("div",j,[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)((0,u.SU)(o),(e,t)=>((0,u.wg)(),(0,u.iD)("div",{key:t,class:(0,u.C_)(["choose-item",{active:(0,u.SU)(s)==e}]),onClick:t=>s.value=e},[(0,u._)("span",D,(0,u.zw)(e),1)],10,A))),128))]),(0,u._)("div",{class:(0,u.C_)(["url-source",{hidden:"AI"!==(0,u.SU)(s)}])},[t[2]||(t[2]=(0,u._)("span",{class:"label"},"Source Url",-1)),(0,u.Wm)(a,{value:(0,u.SU)(d),"onUpdate:value":t[0]||(t[0]=e=>(0,u.dq)(d)?d.value=e:null),class:"flex-1","label-field":"domain","value-field":"domain",options:(0,u.SU)(p)},null,8,["value","options"])],2),t[3]||(t[3]=(0,u._)("div",{class:"desc"}," Use AI tools to help you automatically generate email content and improve your work efficiency. ",-1))])]),_:1},8,["show"])}}});var L=a(83744);let O=(0,L.default)(E,[["__scopeId","data-v-4c626d5e"]]);var N=a(23865);let F={class:"p-24px"};function V(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,u.lA)(e)}let q=(0,u.aZ)({__name:"index",setup(e){let t=(0,M.tv)(),{t:a}=(0,N.QT)(),h=(0,u.iH)(),{tableParams:g,tableList:_,loading:y,tableTotal:w,getTableData:S}=(0,m.Z)({loading:!0,immediate:!0,params:{page:1,page_size:10,keyword:""},fetchFn:v.A8}),U=(0,u.iH)([{key:"temp_name",title:a("market.template.columns.name"),minWidth:120,ellipsis:{tooltip:!0},render:e=>(0,u.Wm)(r.ZP,{type:"primary",text:!0,onClick:()=>{C(e)}},{default:()=>[e.temp_name]})},{key:"add_type",title:"Type",minWidth:140,render:e=>1===e.add_type?(0,u.Wm)(d.ZP,{size:"small",bordered:!1,type:"primary"},{default:()=>[(0,u.Uk)("Drag")]}):0===e.add_type?(0,u.Wm)(d.ZP,{size:"small",bordered:!1,type:"info"},{default:()=>[(0,u.Uk)("HTML")]}):2==e.add_type?(0,u.Wm)(d.ZP,{size:"small",bordered:!1,type:"success"},{default:()=>[(0,u.Uk)("AI")]}):void 0},{key:"create_time",title:a("market.template.columns.createdAt"),minWidth:140,render:e=>(0,f.mr)(e.create_time)},{title:a("common.columns.actions"),key:"actions",align:"right",width:240,render:e=>{let t,l,n,i;return(0,u.Wm)(c.Z,{inline:!0},{default:()=>[(0,u.Wm)(r.ZP,{type:"primary",text:!0,onClick:()=>{P(e.html_content)}},V(t=a("common.actions.preview"))?t:{default:()=>[t]}),(0,u.Wm)(r.ZP,{type:"primary",text:!0,onClick:()=>{C(e)}},V(l=a("common.actions.edit"))?l:{default:()=>[l]}),(0,u.Wm)(r.ZP,{type:"primary",text:!0,disabled:2==e.add_type,onClick:()=>{z(e)}},V(n=a("market.template.actions.duplicate"))?n:{default:()=>[n]}),(0,u.Wm)(r.ZP,{type:"error",text:!0,onClick:()=>{$(e)}},V(i=a("common.actions.delete"))?i:{default:()=>[i]})]})}}]),[k,Z]=(0,p.d)({component:W,state:{isEdit:!1,refresh:S,preview:e=>{P(e)}}}),x=()=>{h.value.open()},b=e=>{"Drag"==e?Z.setState({isEdit:!1,type:1,row:null}):"HTML"==e&&Z.setState({isEdit:!1,type:0,row:null}),Z.open()},C=e=>{2==e.add_type&&e.chat_id?t.push({name:"ai-template",params:{chatId:e.chat_id}}):(Z.setState({isEdit:!0,row:e}),Z.open())},[T,H]=(0,p.d)({component:I}),P=e=>{H.setState({html:e}),H.open()},z=async e=>{await (0,v.ef)({id:e.id}),S()},$=e=>{(0,f.iG)({title:a("market.template.delete.title"),content:a("market.template.delete.confirm",{name:e.temp_name}),confirmText:a("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await (0,v.Xc)({id:e.id}),S()}})};return(e,t)=>{let d=s.Z,c=o.Z,p=i.Z,m=n.Z,f=l.Z;return(0,u.wg)(),(0,u.iD)(u.HY,null,[(0,u._)("div",F,[t[4]||(t[4]=(0,u._)("div",{class:"bt-title"},"模板",-1)),(0,u.Wm)(f,null,{toolsLeft:(0,u.w5)(()=>[(0,u.Wm)((0,u.SU)(r.ZP),{type:"primary",onClick:x},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)((0,u.SU)(a)("market.template.actions.add")),1)]),_:1})]),toolsRight:(0,u.w5)(()=>[(0,u.Wm)(d,{value:(0,u.SU)(g).keyword,"onUpdate:value":t[0]||(t[0]=e=>(0,u.SU)(g).keyword=e),width:240,placeholder:(0,u.SU)(a)("market.template.search.namePlaceholder"),onSearch:t[1]||(t[1]=()=>(0,u.SU)(S)(!0))},null,8,["value","placeholder"])]),table:(0,u.w5)(()=>[(0,u.Wm)(p,{loading:(0,u.SU)(y),columns:(0,u.SU)(U),data:(0,u.SU)(_)},{empty:(0,u.w5)(()=>[(0,u.Wm)(c)]),_:1},8,["loading","columns","data"])]),pageRight:(0,u.w5)(()=>[(0,u.Wm)(m,{page:(0,u.SU)(g).page,"onUpdate:page":t[2]||(t[2]=e=>(0,u.SU)(g).page=e),"page-size":(0,u.SU)(g).page_size,"onUpdate:pageSize":t[3]||(t[3]=e=>(0,u.SU)(g).page_size=e),"item-count":(0,u.SU)(w),onRefresh:(0,u.SU)(S)},null,8,["page","page-size","item-count","onRefresh"])]),modal:(0,u.w5)(()=>[(0,u.Wm)((0,u.SU)(k)),(0,u.Wm)((0,u.SU)(T))]),_:1})]),(0,u.Wm)(O,{ref_key:"createTemplateModalRef",ref:h,onConfirmType:b},null,512)],64)}}}),K=(0,L.default)(q,[["__scopeId","data-v-3f9e7cdf"]])}}]);