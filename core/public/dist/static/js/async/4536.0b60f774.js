"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["4536"],{84075:function(e,t,a){a.d(t,{WH:()=>r,hI:()=>i,sS:()=>o,vi:()=>u});var l=a(34541);let{t:s}=a(76882).Z.global,i=e=>l.e.get("/contact/group/list",{params:e}),r=()=>l.e.get("/contact/group/all"),o=e=>l.e.post("/contact/group/create",e,{fetchOptions:{loading:s("contacts.group.loading.createGroup"),successMessage:!0}}),u=e=>l.e.post("/contact/group/contact_count",e)},86559:function(e,t,a){a.d(t,{Z:()=>i});var l=a(73084),s=a(58786);let i=(0,s.aZ)({__name:"index",props:(0,s.Vf)({width:{default:240},prefix:{type:Boolean,default:!1}},{value:{default:""},valueModifiers:{}}),emits:(0,s.Vf)(["search"],["update:value"]),setup(e,t){let{expose:a,emit:i}=t,r=(0,s.iH)(null),o=(0,s.tT)(e,"value"),u=()=>{i("search",o.value)};return a({focus:()=>{var e;null==(e=r.value)||e.focus()}}),(e,t)=>{let a=l.Z;return(0,s.wg)(),(0,s.j4)(a,(0,s.dG)({ref_key:"inputRef",ref:r,value:o.value,"onUpdate:value":t[0]||(t[0]=e=>o.value=e)},e.$attrs,{class:"bt-search",style:{width:`${e.width}px`},onKeyup:(0,s.D2)(u,["enter"])}),(0,s.Nv)({_:2},[e.prefix?{name:"prefix",fn:(0,s.w5)(()=>[(0,s._)("div",{class:"flex items-center cursor-pointer",onClick:u},t[1]||(t[1]=[(0,s._)("i",{class:"i-mdi-search text-16px"},null,-1)]))]),key:"0"}:void 0,e.prefix?void 0:{name:"suffix",fn:(0,s.w5)(()=>[(0,s._)("div",{class:"flex items-center cursor-pointer",onClick:u},t[2]||(t[2]=[(0,s._)("i",{class:"i-mdi-search text-16px"},null,-1)]))]),key:"1"}]),1040,["value","style"])}}})},58695:function(e,t,a){a.r(t),a.d(t,{default:()=>B});var l=a(39244),s=a(25170),i=a(75754),r=a(66760),o=a(86559),u=a(16715),n=a(77227),c=a(58786),p=a(94821),d=a(93953),m=a(67655),v=a(51169),b=a(67512),f=a(68271),g=a(34541);let{t:_}=a(76882).Z.global,w=e=>g.e.get("/contact/list",{params:e}),U=e=>g.e.post("/contact/group/import",e,{fetchOptions:{loading:_("contacts.group.loading.importSubscribers"),successMessage:!0}}),S=e=>g.e.post("/contact/edit",e,{fetchOptions:{loading:_("contacts.group.loading.updateSubscriberGroup"),successMessage:!0}}),y=e=>g.e.post("/contact/delete",e,{fetchOptions:{loading:_("contacts.group.loading.deleteSubscriber"),successMessage:!0}});var h=a(8490),x=a(84075),W=a(52495);let Z=(0,c.aZ)({__name:"GroupSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let{t}=(0,W.QT)(),a=(0,c.tT)(e,"value"),l=(0,c.iH)([{label:t("common.all.text"),value:""}]),s=e=>{let{option:a}=e;return`${t("contacts.subscribers.select.prefix")}${a.label}`};return(async()=>{let e=await (0,x.WH)();(0,f.Kn)(e)&&(l.value=e.list.map(e=>({label:e.name,value:e.id})),l.value.unshift({label:t("common.all.text"),value:""}))})(),(e,t)=>{let i=h.Z;return(0,c.wg)(),(0,c.j4)(i,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:(0,c.SU)(l),renderTag:s},null,8,["value","options"])}}});var k=a(46244),$=a(73084),z=a(3179),O=a(81833),C=a(37864),R=a(6455),j=a(46471),H=a(98003);let T=(0,c.aZ)({__name:"GroupMultipleSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let t=(0,c.tT)(e,"value"),a=(0,c.iH)([]),l=(0,c.iH)(!1);return(async()=>{try{l.value=!0;let e=await (0,x.WH)();(0,f.Kn)(e)&&(a.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{l.value=!1}})(),(e,s)=>{let i=h.Z;return(0,c.wg)(),(0,c.j4)(i,{value:t.value,"onUpdate:value":s[0]||(s[0]=e=>t.value=e),"max-tag-count":"responsive",multiple:!0,filterable:!0,loading:(0,c.SU)(l),options:(0,c.SU)(a)},null,8,["value","loading","options"])}}}),P={class:"pt-12px"},q={class:"flex-1"},M={class:"mb-8px text-desc"},D={class:"w-260px"},G={class:"flex-1"},A={class:"mt-8px"},E={class:"mt-8px text-12px text-desc"},F={class:"mt-8px text-12px text-desc"},I=`email,attributes
example1@example.com,"{""age"": ""13"", ""Gender"": ""XXX""}"
example2@example.com,"{""age"": ""45"", ""city"": ""XXX""}"
`,X=(0,c.aZ)({__name:"SubscriberImport",setup(e){let{t}=(0,W.QT)(),a=(0,c.AE)("formRef"),l=(0,c.iH)("paste"),s=(0,c.qj)({group_ids:[],import_type:1,contacts:"",file_data:"",file_type:"",overwrite:0,default_active:1,status:1}),i={group_ids:{trigger:"change",validator:()=>0!==s.group_ids.length||Error(t("contacts.subscribers.import.validation.groupRequired"))},contacts:{validator:()=>!(2===s.import_type&&(0,j.Z)(s.contacts))||Error(t("contacts.subscribers.import.validation.dataRequired"))}},r=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.overwriteOptions.no"),value:0},{label:t("contacts.subscribers.import.overwriteOptions.yes"),value:1}]),o=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.subscriptionOptions.subscribe"),value:1},{label:t("contacts.subscribers.import.subscriptionOptions.unsubscribe"),value:0}]),p=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),d=e=>{let t=new FileReader;t.onload=t=>{var a;s.file_type=e.name.substring(e.name.lastIndexOf(".")+1),s.file_data=null==(a=t.target)?void 0:a.result},e.file&&t.readAsText(e.file)},b=async()=>{await (0,H.Sv)({file_path:"./template/example_recipients.csv"})},g=async()=>{var e;if(await (null==(e=a.value)?void 0:e.validate()),"upload"===l.value&&(0,j.Z)(s.file_data))return f.v0.error(t("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[_,w]=(0,v.d)({onChangeState:e=>{if(e){let e=w.getState();(null==e?void 0:e.group_id)?s.group_ids=[e.group_id]:s.group_ids=[]}else s.import_type=1,s.contacts="",s.file_data="",s.file_type="",s.group_ids=[],s.overwrite=0,s.default_active=1,s.status=1},onConfirm:async()=>{await g(),await U((0,c.IU)(s));let e=w.getState();null==e||e.refresh()}});return(e,t)=>{let l=h.Z,v=R.ZP,f=C.ZP,g=O.Z,w=n.Z,U=u.Z,S=z.Z,y=m.ZP,x=$.Z,W=k.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(_),{title:e.$t("contacts.subscribers.import.title"),width:"600"},{default:(0,c.w5)(()=>[(0,c._)("div",P,[(0,c.Wm)(W,{ref_key:"formRef",ref:a,model:(0,c.SU)(s),rules:i},{default:(0,c.w5)(()=>[(0,c.Wm)(v,{label:e.$t("contacts.subscribers.import.overwriteLabel")},{default:(0,c.w5)(()=>[(0,c._)("div",q,[(0,c._)("div",M,(0,c.zw)(e.$t("contacts.subscribers.import.overwriteDescription")),1),(0,c._)("div",D,[(0,c.Wm)(l,{value:(0,c.SU)(s).overwrite,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(s).overwrite=e),options:(0,c.SU)(r)},null,8,["value","options"])])])]),_:1},8,["label"]),(0,c.Wm)(g,{cols:2,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(f,{span:1,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.w5)(()=>[(0,c.Wm)(l,{value:(0,c.SU)(s).default_active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(s).default_active=e),options:(0,c.SU)(o)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.Wm)(f,{span:1,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.w5)(()=>[(0,c.Wm)(l,{value:(0,c.SU)(s).status,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(s).status=e),options:(0,c.SU)(p)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(v,{label:e.$t("contacts.subscribers.import.group"),path:"group_id"},{default:(0,c.w5)(()=>[(0,c.Wm)(T,{value:(0,c.SU)(s).group_ids,"onUpdate:value":t[3]||(t[3]=e=>(0,c.SU)(s).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(v,{label:e.$t("contacts.subscribers.import.data"),path:"contacts"},{default:(0,c.w5)(()=>[(0,c._)("div",G,[(0,c.Wm)(U,{value:(0,c.SU)(s).import_type,"onUpdate:value":t[4]||(t[4]=e=>(0,c.SU)(s).import_type=e)},{default:(0,c.w5)(()=>[(0,c.Wm)(w,{value:1},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.uploadFile")),1)]),_:1}),(0,c.Wm)(w,{value:2},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.pasteData")),1)]),_:1})]),_:1},8,["value"]),(0,c._)("div",A,[1===(0,c.SU)(s).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:0},[(0,c.Wm)(S,{"is-upload":!1,accept:["csv"],onChange:d}),(0,c._)("div",E,[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,c.Wm)(y,{text:"",type:"primary",onClick:b},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("common.actions.download")),1)]),_:1})])],64)):(0,c.kq)("",!0),2===(0,c.SU)(s).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:1},[(0,c.Wm)(x,{value:(0,c.SU)(s).contacts,"onUpdate:value":t[5]||(t[5]=e=>(0,c.SU)(s).contacts=e),type:"textarea",rows:8},null,8,["value"]),(0,c._)("div",F,[(0,c._)("p",null,(0,c.zw)(e.$t("contacts.subscribers.import.pastePlaceholder.0")),1)])],64)):(0,c.kq)("",!0)])])]),_:1},8,["label"]),(0,c.Wm)(v,{label:e.$t("contacts.subscribers.import.exampleCsvLabel")},{default:(0,c.w5)(()=>[(0,c._)("pre",{class:"csv-example"},(0,c.zw)(I))]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var L=a(41748);let N=(0,L.default)(X,[["__scopeId","data-v-22187ee4"]]),Q={class:"pt-12px"},J=(0,c.aZ)({__name:"SubscriberEdit",setup(e){let{t}=(0,W.QT)(),a=(0,c.AE)("formRef"),l=(0,c.qj)({email:"",active:1,attribs:"",group_ids:[]}),s={group_ids:{trigger:"change",validator:()=>0!==l.group_ids.length||Error(t("contacts.subscribers.edit.validation.groupRequired"))}},i=[{label:"Subscribe",value:1},{label:"Unsubscribe",value:0}],[r,o]=(0,v.d)({onChangeState:e=>{if(e){let{row:e}=o.getState();e&&(l.email=e.email,l.active=e.active,l.group_ids=e.groups.map(e=>e.id),l.attribs=e.attribs?JSON.stringify(e.attribs,null,2):"")}else l.email="",l.active=1,l.group_ids=[],l.attribs=""},onConfirm:async()=>{var e;await (null==(e=a.value)?void 0:e.validate());let t={};try{t=l.attribs?JSON.parse(l.attribs):{}}catch(e){return f.v0.error(`${e}`,{close:!0}),!1}await S({emails:l.email,group_ids:l.group_ids,active:l.active,attribs:JSON.stringify(t)}),o.getState().refresh()}});return(e,t)=>{let o=$.Z,u=C.ZP,n=h.Z,p=O.Z,d=R.ZP,m=k.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(r),{title:e.$t("contacts.subscribers.edit.title"),width:"600"},{default:(0,c.w5)(()=>[(0,c._)("div",Q,[(0,c.Wm)(m,{ref_key:"formRef",ref:a,model:(0,c.SU)(l),rules:s},{default:(0,c.w5)(()=>[(0,c.Wm)(p,{cols:12,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(u,{span:8,label:e.$t("contacts.subscribers.edit.email")},{default:(0,c.w5)(()=>[(0,c.Wm)(o,{value:(0,c.SU)(l).email,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(l).email=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(u,{span:4,label:"Status"},{default:(0,c.w5)(()=>[(0,c.Wm)(n,{value:(0,c.SU)(l).active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(l).active=e),options:i},null,8,["value"])]),_:1})]),_:1}),(0,c.Wm)(d,{label:e.$t("contacts.subscribers.edit.group"),path:"group_ids"},{default:(0,c.w5)(()=>[(0,c.Wm)(T,{value:(0,c.SU)(l).group_ids,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(l).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(d,{label:"Attributes",path:"group_ids"},{default:(0,c.w5)(()=>[(0,c.Wm)(o,{value:(0,c.SU)(l).attribs,"onUpdate:value":t[3]||(t[3]=e=>(0,c.SU)(l).attribs=e),type:"textarea",rows:6},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["title"])}}}),K={class:"w-200px"};function V(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,c.lA)(e)}let Y=(0,c.aZ)({__name:"index",setup(e){let{t}=(0,W.QT)(),a=(0,p.tLD)(),{tableParams:g,tableList:_,loading:U,tableTotal:S,getTableData:h}=(0,b.Z)({loading:!0,immediate:!0,params:{page:1,page_size:10,group_id:a.value.state.group_id||"",keyword:"",status:1},fetchFn:w}),x=(0,c.iH)([{key:"email",title:t("contacts.subscribers.columns.email"),minWidth:120,ellipsis:{tooltip:!0}},{key:"groups",title:t("contacts.subscribers.columns.name"),minWidth:100,render:e=>e.groups.map(e=>e.name).join(", ")},{key:"create_time",title:t("contacts.subscribers.columns.createdAt"),minWidth:140,render:e=>(0,f.mr)(e.create_time)},{title:t("common.columns.actions"),key:"actions",align:"right",width:180,render:e=>{let a,l;return(0,c.Wm)(d.Z,{inline:!0},{default:()=>[(0,c.Wm)(m.ZP,{type:"primary",text:!0,onClick:()=>{R(e)}},V(a=t("common.actions.edit"))?a:{default:()=>[a]}),(0,c.Wm)(m.ZP,{type:"error",text:!0,onClick:()=>{j(e)}},V(l=t("common.actions.delete"))?l:{default:()=>[l]})]})}}]),[k,$]=(0,v.d)({component:N,state:{refresh:h}}),z=()=>{$.setState({group_id:g.value.group_id}),$.open()},[O,C]=(0,v.d)({component:J,state:{refresh:h}}),R=e=>{C.setState({row:e}),C.open()},j=e=>{(0,f.iG)({title:t("contacts.subscribers.delete.title"),content:t("contacts.subscribers.delete.confirm",{email:e.email}),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await y({emails:[e.email],status:g.value.status}),h()}})};return(e,a)=>{let p=n.Z,d=u.Z,v=o.Z,b=r.Z,f=i.Z,w=s.Z,y=l.Z;return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.Wm)(y,null,{toolsLeft:(0,c.w5)(()=>[(0,c.Wm)((0,c.SU)(m.ZP),{type:"primary",onClick:z},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("common.actions.import")),1)]),_:1})]),toolsRight:(0,c.w5)(()=>[(0,c.Wm)(d,{value:(0,c.SU)(g).status,"onUpdate:value":[a[0]||(a[0]=e=>(0,c.SU)(g).status=e),a[1]||(a[1]=()=>(0,c.SU)(h)(!0))]},{default:(0,c.w5)(()=>[(0,c.Wm)(p,{value:1},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("contacts.subscribers.status.subscribed")),1)]),_:1}),(0,c.Wm)(p,{value:0},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("contacts.subscribers.status.unsubscribed")),1)]),_:1})]),_:1},8,["value"]),(0,c._)("div",K,[(0,c.Wm)(Z,{value:(0,c.SU)(g).group_id,"onUpdate:value":[a[2]||(a[2]=e=>(0,c.SU)(g).group_id=e),a[3]||(a[3]=()=>(0,c.SU)(h)(!0))]},null,8,["value"])]),(0,c.Wm)(v,{value:(0,c.SU)(g).keyword,"onUpdate:value":a[4]||(a[4]=e=>(0,c.SU)(g).keyword=e),width:240,placeholder:(0,c.SU)(t)("contacts.subscribers.search.emailPlaceholder"),onSearch:a[5]||(a[5]=()=>(0,c.SU)(h)(!0))},null,8,["value","placeholder"])]),table:(0,c.w5)(()=>[(0,c.Wm)(f,{loading:(0,c.SU)(U),columns:(0,c.SU)(x),data:(0,c.SU)(_)},{empty:(0,c.w5)(()=>[(0,c.Wm)(b)]),_:1},8,["loading","columns","data"])]),pageRight:(0,c.w5)(()=>[(0,c.Wm)(w,{page:(0,c.SU)(g).page,"onUpdate:page":a[6]||(a[6]=e=>(0,c.SU)(g).page=e),"page-size":(0,c.SU)(g).page_size,"onUpdate:pageSize":a[7]||(a[7]=e=>(0,c.SU)(g).page_size=e),"item-count":(0,c.SU)(S),onRefresh:(0,c.SU)(h)},null,8,["page","page-size","item-count","onRefresh"])]),modal:(0,c.w5)(()=>[(0,c.Wm)((0,c.SU)(k)),(0,c.Wm)((0,c.SU)(O))]),_:1})])}}}),B=(0,L.default)(Y,[["__scopeId","data-v-c7ec0e9c"]])}}]);