"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["39"],{69288:function(e,a,t){t.d(a,{DP:()=>w,Ew:()=>r,I5:()=>m,JI:()=>h,L3:()=>c,Nh:()=>y,UY:()=>g,WJ:()=>p,nn:()=>_});var l=t(77527),n=t(86244),i=t(25595);let{t:o}=l.Z.global,s={fetchOptions:{loading:o("template.ai.loading.message"),successMessage:!0}};async function u(e,a){try{await n.e.post("/email_template/create",{temp_name:a,add_type:2,chat_id:e,html_content:""})}catch(e){throw console.warn(e),e}}async function c(e){await d(e),await v(e)}async function r(e){try{let a=`AI_temp_${new Date().getTime()}`,t=await n.e.post("/askai/chat/create_chat",{domain:e,add_type:99,temp_name:a},s);return await u(t.chatId,a),t.chatId}catch(e){return console.warn(e),null}}async function d(e){let{modelList:a,currentModel:t,currentModelTitle:l}=e;try{a.value=await n.e.post("/askai/supplier/models"),a.value.length&&(t.value=a.value[0],l.value=a.value[0].title)}catch(e){console.warn(e)}}async function v(e){let{chatId:a,chatInfo:t,currentModel:l,modelList:i,currentModelTitle:o,chatRecord:s,usageRecord:u}=e;try{if(t.value=await n.e.post("/askai/chat/info",{chatId:a.value}),t.value.modelId&&i.value.length){let e=i.value.find(e=>e.modelId==t.value.modelId);e&&(l.value=e,o.value=e.title)}for(let e=0;e<t.value.messages.length;e++){let a=`${t.value.messages[e].content}_+_${s.value.size}`;"user"==t.value.messages[e].role&&(s.value.set(a,f(t.value.messages[e+1].content)),u.value.set(a,t.value.messages[e+1].usage))}}catch(e){console.warn(e)}}async function m(e){let{chatId:a,isChat:t}=e;try{await n.e.post("/askai/chat/stop",{chatId:a.value},s),t.value=!1}catch(e){console.warn(e)}}async function p(e,a){let{scrollable:t,generateShow:l,chatId:o,currentModel:s,questionContent:u,chatRecord:c,currentChatRecordKey:r,scrollWrapperRef:d,chatScrollRef:v,isChat:m,usageRecord:p}=e;if(m.value||!u.value||a&&function(e,a){if(e.shiftKey&&"Enter"===e.key){e.preventDefault();let t=e.target,l=t.selectionStart,n=t.selectionEnd;return a.value=a.value.substring(0,l)+"\n"+a.value.substring(n),t.selectionStart=t.selectionEnd=l+1,!0}}(a,u))return;let h=`${u.value}_+_${c.value.size}`;c.value.set(h,[]),r.value=h;let g=u.value;u.value="";let w=[],_="",k=0;try{t.value=!0,l.value=!0,m.value=!0,(0,i.Y3)(()=>v.value.scrollTo({left:0,top:d.value.offsetHeight})),await n.e.post("/askai/chat/chat",{chatId:o.value,supplierName:s.value.supplierName,modelId:s.value.modelId,content:g,is_text:"false"},{fetchOptions:{cancelResInterceptor:!0},responseType:"text",onDownloadProgress:e=>{l.value=!1;try{let l=e.event.target.responseText,n=l.slice(k);k=l.length;var a=function(e){let a=e.split("\n"),t=[];for(let e of a){let a=e.trim();if(a.startsWith("data:")){let e=a.slice(5).trim();e&&t.push(e)}}return t}(n);for(let e=0;e<a.length;e++)a[e]&&(_+=JSON.parse(a[e]).content);c.value.set(h,f(_)),t.value&&setTimeout(()=>v.value.scrollTo({left:0,top:d.value.offsetHeight}),200)}catch(e){console.warn(e)}}}),t.value=!0,v.value.scrollTo({left:0,top:d.value.offsetHeight}),m.value=!1,y(e,e=>{p.value.set(h,e)})}catch(e){console.warn(e)}finally{l.value=!1,_="",k=0}}function f(e){let a=/```[\s\S]*?(?:```|$)/g,t=e.match(a)||[],l=e.split(a),n=[],i=Math.max(l.length,t.length);for(let e=0;e<i;e++)e<l.length&&""!==l[e].trim()&&n.push(l[e]),e<t.length&&n.push(t[e]);return n}function h(e){return e.replace(/```html/g,"").replace(/```$/gm,"")}function g(e){return e.replace(/<<<<<<<\s+SEARCH[\s\S]*?=======([\s\S]*?)>>>>>>>\s+REPLACE/g,"$1")}function w(e){let a=e.match(/<title>(.*?)<\/title>/i);return a?a[1]:""}async function y(e,a){let{chatId:t,previewCode:l,previewTit:i}=e;try{let e=await n.e.post("/askai/chat/get_html",{chatId:t.value});l.value=e.html_content,i.value=w(l.value),a&&a(e.last_usage)}catch(e){console.warn(e)}}async function _(e){let{previewCode:a,chatId:t}=e;try{await n.e.post("/askai/chat/modify_html",{chatId:t.value,content:a.value},s),y(e)}catch(e){console.warn(e)}}},18106:function(e,a,t){t.d(a,{Z:()=>$});var l=t(24950),n=t(87),i=t(58619),o=t(99833),s=t(46126),u=t(25595),c=t(86244),r=t(69288),d=t(86695),v=t(25464);let m=t.p+"static/image/model-notice.a300ae20.png",p=t.p+"static/image/create-brand-info.5daf2552.png";var f=t(29938);let h={class:"wrapper"},g={class:"creation-methods"},w=["onClick"],y={class:"item-label"},_={class:"label"},k={key:0,class:"desc"},S={key:1},b={key:2},U={key:3},I={class:"flex justify-end"},T=(0,u.aZ)({__name:"CreateTplModal",props:{onlyAi:{type:Boolean}},emits:["confirmType","hasCreateTpl"],setup(e,a){let{expose:t,emit:T}=a,$=(0,d.s6)(),C=(0,f.tv)(),W=(0,u.iH)(["Drag","AI","HTML"]),D=(0,u.iH)("AI"),z=(0,u.iH)(""),A=(0,u.iH)(!1),H=(0,u.iH)([]),x=(0,u.iH)(!1),E=(0,u.Fl)(()=>e.onlyAi?["AI"]:W.value),Z=(0,u.Fl)(()=>{if(0==N.value.length)return"domain-list-empty";if(!x.value)return"ai-configuration-invalid";let e=H.value.find(e=>e.domain==z.value);return e&&1!==e.hasbrandinfo?"invalid-brand-domain":"normal"}),N=(0,u.Fl)(()=>[...H.value].sort((e,a)=>a.hasbrandinfo-e.hasbrandinfo)),L=(0,u.Fl)(()=>"AI"==D.value&&0==N.value.length);async function M(){if("AI"==D.value){let e=await (0,r.Ew)(z.value);e&&($.domainSource=z.value,C.push({name:"ai-template",params:{chatId:e}}))}else T("confirmType",D.value)}function P(){C.push({name:"Domain",query:{init:"init-domain"}})}function q(){C.push({name:"AiModel"})}function F(){C.push({name:"EditDomain",params:{domain:z.value}})}function J(e){return e.hasbrandinfo?(0,u.Wm)("div",null,[(0,u.Wm)("i",{class:"i-domain:brand-info w-4 h-4 mr-1.25"},null),(0,u.Uk)(" "),(0,u.Wm)("span",null,[e.domain])]):(0,u.Wm)("span",null,[e.domain])}async function O(){if(H.value=(await c.e.get("/domains/list",{params:{page:1,page_size:100}})).list,0==H.value.length){$.domainSource="",z.value="";return}$.domainSource&&(z.value=$.domainSource),N.value.length>0&&(z.value=N.value[0].domain,$.domainSource=N.value[0].domain)}return t({open:async function e(){x.value=(await (0,v.Lb)()).is_configured,await O(),$.domainSource&&($.domainSource=z.value),A.value=!0},close:function(){A.value=!1}}),(e,a)=>{let t=s.Z,c=o.ZP,r=i.Z,d=n.ZP,v=l.Z;return(0,u.wg)(),(0,u.j4)(v,{show:(0,u.SU)(A),"onUpdate:show":a[1]||(a[1]=e=>(0,u.dq)(A)?A.value=e:null),preset:"card",draggable:"","close-on-esc":!1,"mask-closable":!1,segmented:"",class:"w-110",title:""},{footer:(0,u.w5)(()=>[(0,u._)("div",I,[(0,u.Wm)(c,{type:"primary",disabled:(0,u.SU)(L)||["domain-list-empty","ai-configuration-invalid","invalid-brand-domain"].includes((0,u.SU)(Z)),onClick:M},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.create")),1)]),_:1},8,["disabled"])])]),default:(0,u.w5)(()=>[(0,u._)("div",h,[(0,u._)("div",g,[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)((0,u.SU)(E),(e,a)=>((0,u.wg)(),(0,u.iD)("div",{key:a,class:(0,u.C_)(["choose-item",{active:(0,u.SU)(D)==e}]),onClick:a=>D.value=e},[(0,u._)("span",y,(0,u.zw)(e),1)],10,w))),128))]),(0,u._)("div",{class:(0,u.C_)(["url-source",{hidden:"AI"!==(0,u.SU)(D)}])},[(0,u._)("span",_,(0,u.zw)(e.$t("template.createTpl.sourceUrl")),1),(0,u.Wm)(t,{value:(0,u.SU)(z),"onUpdate:value":a[0]||(a[0]=e=>(0,u.dq)(z)?z.value=e:null),class:"flex-1","label-field":"domain","value-field":"domain",options:(0,u.SU)(N),disabled:(0,u.SU)(L),"render-label":J},null,8,["value","options","disabled"])],2),"normal"==(0,u.SU)(Z)?((0,u.wg)(),(0,u.iD)("div",k,(0,u.zw)(e.$t("template.createTpl.useAiTools")),1)):"domain-list-empty"==(0,u.SU)(Z)?((0,u.wg)(),(0,u.iD)("div",S,[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.notices.domainListEmpty"))+", ",1),(0,u.Wm)(c,{text:"",type:"primary",onClick:P},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.buttons.createNow")),1)]),_:1})])):"ai-configuration-invalid"==(0,u.SU)(Z)?((0,u.wg)(),(0,u.iD)("div",b,[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.notices.aiConfigurationInvalid"))+", ",1),(0,u.Wm)(d,{trigger:"hover",placement:"right"},{trigger:(0,u.w5)(()=>[(0,u.Wm)(c,{text:"",type:"primary",onClick:q},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.buttons.configureNow")),1)]),_:1})]),default:(0,u.w5)(()=>[(0,u.Wm)(r,{src:(0,u.SU)(m),width:"600"},null,8,["src"])]),_:1})])):"invalid-brand-domain"==(0,u.SU)(Z)?((0,u.wg)(),(0,u.iD)("div",U,[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.notices.invalidBrandDomain"))+", ",1),(0,u.Wm)(d,{trigger:"hover",placement:"right"},{trigger:(0,u.w5)(()=>[(0,u.Wm)(c,{text:"",type:"primary",onClick:F},{default:(0,u.w5)(()=>[(0,u.Uk)((0,u.zw)(e.$t("template.createTpl.buttons.createNow")),1)]),_:1})]),default:(0,u.w5)(()=>[(0,u.Wm)(r,{src:(0,u.SU)(p),width:"600"},null,8,["src"])]),_:1})])):(0,u.kq)("",!0)])]),_:1},8,["show"])}}}),$=(0,t(83744).default)(T,[["__scopeId","data-v-703c87a8"]])}}]);