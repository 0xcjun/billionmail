"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["248"],{6471:function(e,t,a){a.d(t,{Z:()=>p});var l=a(2510),r=a(1792),i=a(5266),s=a(3073),o=a(7737),n=a(4339),u=a(8168),c=a(3754),d=Object.prototype.hasOwnProperty;let p=function(e){if(null==e)return!0;if((0,o.Z)(e)&&((0,s.Z)(e)||"string"==typeof e||"function"==typeof e.splice||(0,n.Z)(e)||(0,c.Z)(e)||(0,i.Z)(e)))return!e.length;var t=(0,r.Z)(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if((0,u.Z)(e))return!(0,l.Z)(e).length;for(var a in e)if(d.call(e,a))return!1;return!0}},2822:function(e,t,a){a.d(t,{Z:()=>i});var l=a(1452),r=a(2398);let i=function(e){return"number"==typeof e||(0,r.Z)(e)&&"[object Number]"==(0,l.Z)(e)}},7714:function(e,t,a){a.d(t,{Z:()=>f});var l=a(5083),r=a(209),i=a(1321),s=a(4124),o=a(2931),n=a(2249),u=a(6253),c=a(3876),d=a(8713);let p={name:"Flex",self:function(){return d.Z}},m=Object.assign(Object.assign({},i.Z.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrap:{type:Boolean,default:!0}}),f=(0,r.aZ)({name:"Flex",props:m,setup(e){let{mergedClsPrefixRef:t,mergedRtlRef:a}=(0,s.ZP)(e),u=(0,i.Z)("Flex","-flex",void 0,p,e,t);return{rtlEnabled:(0,o.V)("Flex",a,t),mergedClsPrefix:t,margin:(0,r.Fl)(()=>{let{size:t}=e;if(Array.isArray(t))return{horizontal:t[0],vertical:t[1]};if("number"==typeof t)return{horizontal:t,vertical:t};let{self:{[(0,n.Tl)("gap",t)]:a}}=u.value,{row:r,col:i}=(0,l.yU)(a);return{horizontal:(0,l.fQ)(i),vertical:(0,l.fQ)(r)}})}},render(){let{vertical:e,reverse:t,align:a,inline:l,justify:i,margin:s,wrap:o,mergedClsPrefix:n,rtlEnabled:d}=this,p=(0,u.x)((0,c.z)(this),!1);return p.length?(0,r.h)("div",{role:"none",class:[`${n}-flex`,d&&`${n}-flex--rtl`],style:{display:l?"inline-flex":"flex",flexDirection:e&&!t?"column":e&&t?"column-reverse":!e&&t?"row-reverse":"row",justifyContent:i,flexWrap:!o||e?"nowrap":"wrap",alignItems:a,gap:`${s.vertical}px ${s.horizontal}px`}},p):null}})},8943:function(e,t,a){a.d(t,{Z:()=>s});var l=a(209),r=a(8282),i=a(8842);let s=(0,l.aZ)({name:"RadioButton",props:i.xu,setup:i.cY,render(){let{mergedClsPrefix:e}=this;return(0,l.h)("label",{class:[`${e}-radio-button`,this.mergedDisabled&&`${e}-radio-button--disabled`,this.renderSafeChecked&&`${e}-radio-button--checked`,this.focus&&[`${e}-radio-button--focus`]]},(0,l.h)("input",{ref:"inputRef",type:"radio",class:`${e}-radio-input`,value:this.value,name:this.mergedName,checked:this.renderSafeChecked,disabled:this.mergedDisabled,onChange:this.handleRadioInputChange,onFocus:this.handleRadioInputFocus,onBlur:this.handleRadioInputBlur}),(0,l.h)("div",{class:`${e}-radio-button__state-border`}),(0,r.K9)(this.$slots.default,t=>t||this.label?(0,l.h)("div",{ref:"labelRef",class:`${e}-radio__label`},t||this.label):null))}})},1625:function(e,t,a){a.d(t,{WH:()=>s,hI:()=>i,iE:()=>u,mD:()=>n,sS:()=>o,vi:()=>c});var l=a(4203);let{t:r}=a(4958).Z.global,i=e=>l.e.get("/contact/group/list",{params:e}),s=()=>l.e.get("/contact/group/all"),o=e=>l.e.post("/contact/group/create",e,{fetchOptions:{loading:r("contacts.group.loading.createGroup"),successMessage:!0}}),n=e=>l.e.post("/contact/group/update",e,{fetchOptions:{loading:r("contacts.group.loading.updateGroup"),successMessage:!0}}),u=e=>l.e.post("/contact/group/delete",e,{fetchOptions:{loading:r("contacts.group.loading.deleteGroup"),successMessage:!0}}),c=e=>l.e.post("/contact/group/contact_count",e)},2748:function(e,t,a){a.d(t,{Z:()=>i});var l=a(8454),r=a(209);let i=(0,r.aZ)({__name:"index",props:(0,r.Vf)({width:{default:240},prefix:{type:Boolean,default:!1}},{value:{default:""},valueModifiers:{}}),emits:(0,r.Vf)(["search"],["update:value"]),setup(e,t){let{expose:a,emit:i}=t,s=(0,r.iH)(null),o=(0,r.tT)(e,"value"),n=()=>{i("search",o.value)};return a({focus:()=>{var e;null===(e=s.value)||void 0===e||e.focus()}}),(e,t)=>{let a=l.Z;return(0,r.wg)(),(0,r.j4)(a,(0,r.dG)({ref_key:"inputRef",ref:s,value:o.value,"onUpdate:value":t[0]||(t[0]=e=>o.value=e)},e.$attrs,{class:"bt-search",style:{width:`${e.width}px`},onKeyup:(0,r.D2)(n,["enter"])}),(0,r.Nv)({_:2},[e.prefix?{name:"prefix",fn:(0,r.w5)(()=>[(0,r._)("div",{class:"flex items-center cursor-pointer",onClick:n},t[1]||(t[1]=[(0,r._)("i",{class:"i-mdi-search text-16px"},null,-1)]))]),key:"0"}:void 0,e.prefix?void 0:{name:"suffix",fn:(0,r.w5)(()=>[(0,r._)("div",{class:"flex items-center cursor-pointer",onClick:n},t[2]||(t[2]=[(0,r._)("i",{class:"i-mdi-search text-16px"},null,-1)]))]),key:"1"}]),1040,["value","style"])}}})},6893:function(e,t,a){a.r(t),a.d(t,{default:()=>Q});var l=a(4652),r=a(6818),i=a(3435),s=a(6635),o=a(2748),n=a(2171),u=a(8943),c=a(209),d=a(4059),p=a(7714),m=a(3447),f=a(3312),g=a(6949),v=a(2965),b=a(4203);let{t:_}=a(4958).Z.global,h=e=>b.e.get("/contact/list",{params:e}),w=e=>b.e.post("/contact/group/import",e,{fetchOptions:{loading:_("contacts.group.loading.importSubscribers"),successMessage:!0}}),S=e=>b.e.post("/contact/update_group",e,{fetchOptions:{loading:_("contacts.group.loading.updateSubscriberGroup"),successMessage:!0}}),y=e=>b.e.post("/contact/delete",e,{fetchOptions:{loading:_("contacts.group.loading.deleteSubscriber"),successMessage:!0}});var U=a(5891),Z=a(1625),x=a(5778);let k=(0,c.aZ)({__name:"GroupSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let{t}=(0,x.QT)(),a=(0,c.tT)(e,"value"),l=(0,c.iH)([{label:t("common.all.text"),value:""}]),r=e=>{let{option:a}=e;return`${t("contacts.subscribers.select.prefix")}${a.label}`};return(async()=>{let e=await (0,Z.WH)();(0,v.Kn)(e)&&(l.value=e.list.map(e=>({label:e.name,value:e.id})),l.value.unshift({label:t("common.all.text"),value:""}))})(),(e,t)=>{let i=U.Z;return(0,c.wg)(),(0,c.j4)(i,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:(0,c.SU)(l),renderTag:r},null,8,["value","options"])}}});var W=a(3951),$=a(6714),j=a(8454),R=a(6883),z=a(6471);let C=(0,c.aZ)({__name:"GroupMultipleSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let t=(0,c.tT)(e,"value"),a=(0,c.iH)([]),l=(0,c.iH)(!1);return(async()=>{try{l.value=!0;let e=await (0,Z.WH)();(0,v.Kn)(e)&&(a.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{l.value=!1}})(),(e,r)=>{let i=U.Z;return(0,c.wg)(),(0,c.j4)(i,{value:t.value,"onUpdate:value":r[0]||(r[0]=e=>t.value=e),"max-tag-count":"responsive",multiple:!0,filterable:!0,loading:(0,c.SU)(l),options:(0,c.SU)(a)},null,8,["value","loading","options"])}}});var O=a(5822);let T={class:"pt-12px"},M={class:"flex-1"},P={class:"mt-12px"},H={class:"mt-16px text-12px text-desc"},F=(0,c.aZ)({__name:"SubscriberImport",setup(e){let{t}=(0,x.QT)(),a=(0,c.AE)("formRef"),l=(0,c.iH)("paste"),r=(0,c.qj)({group_ids:[],import_type:2,contacts:"",file_data:"",file_type:""}),i={group_ids:{trigger:"change",validator:()=>0!==r.group_ids.length||Error(t("contacts.subscribers.import.validation.groupRequired"))},contacts:{trigger:["input","blur"],validator:()=>!(2===r.import_type&&(0,z.Z)(r.contacts))||Error(t("contacts.subscribers.import.validation.dataRequired"))}},s=e=>{let t=new FileReader;t.onload=t=>{var a;r.file_type=e.name.substring(e.name.lastIndexOf(".")+1),r.file_data=null===(a=t.target)||void 0===a?void 0:a.result},e.file&&t.readAsText(e.file)},o=async()=>{await (0,O.Sv)({file_path:"/opt/Billion-Mail/data/example_recipients.txt"})},d=async()=>{var e;if(await (null===(e=a.value)||void 0===e?void 0:e.validate()),"upload"===l.value&&(0,z.Z)(r.file_data))return v.v0.error(t("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[p,g]=(0,f.d)({onChangeState:e=>{if(e){let e=g.getState();(null==e?void 0:e.group_id)?r.group_ids=[e.group_id]:r.group_ids=[],r.import_type=2,r.contacts="",r.file_data="",r.file_type=""}},onConfirm:async()=>{await d(),await w((0,c.IU)(r));let e=g.getState();null==e||e.refresh()}});return(e,t)=>{let l=R.ZP,d=u.Z,f=n.Z,g=j.Z,v=$.Z,b=m.ZP,_=W.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(p),{title:e.$t("contacts.subscribers.import.title"),width:"500"},{default:(0,c.w5)(()=>[(0,c._)("div",T,[(0,c.Wm)(_,{ref_key:"formRef",ref:a,model:(0,c.SU)(r),rules:i},{default:(0,c.w5)(()=>[(0,c.Wm)(l,{label:e.$t("contacts.subscribers.import.group"),path:"group_id"},{default:(0,c.w5)(()=>[(0,c.Wm)(C,{value:(0,c.SU)(r).group_ids,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(r).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(l,{label:e.$t("contacts.subscribers.import.data"),path:"contacts"},{default:(0,c.w5)(()=>[(0,c._)("div",M,[(0,c.Wm)(f,{value:(0,c.SU)(r).import_type,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(r).import_type=e)},{default:(0,c.w5)(()=>[(0,c.Wm)(d,{value:2},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.pasteData")),1)]),_:1}),(0,c.Wm)(d,{value:1},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.uploadFile")),1)]),_:1})]),_:1},8,["value"]),(0,c._)("div",P,[2===(0,c.SU)(r).import_type?((0,c.wg)(),(0,c.j4)(g,{key:0,value:(0,c.SU)(r).contacts,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(r).contacts=e),type:"textarea",rows:8,placeholder:e.$t("contacts.subscribers.import.pastePlaceholder")},null,8,["value","placeholder"])):1===(0,c.SU)(r).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:1},[(0,c.Wm)(v,{"is-upload":!1,accept:["txt"],onChange:s}),(0,c._)("div",H,[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,c.Wm)(b,{text:"",type:"primary",onClick:o},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("common.actions.download")),1)]),_:1})])],64)):(0,c.kq)("",!0)])])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var I=a(5115);let q=(0,I.default)(F,[["__scopeId","data-v-7a7e776e"]]),B={class:"pt-12px"},D=(0,c.aZ)({__name:"SubscriberEdit",setup(e){let{t}=(0,x.QT)(),a=(0,c.AE)("formRef"),l=(0,c.qj)({email:"",status:1,group_ids:[]}),r={email:{required:!0,message:t("contacts.subscribers.edit.validation.emailRequired"),trigger:"blur"},group_ids:{trigger:"change",validator:()=>0!==l.group_ids.length||Error(t("contacts.subscribers.edit.validation.groupRequired"))}},[i,s]=(0,f.d)({onChangeState:e=>{if(e){let{row:e}=s.getState();e&&(l.email=e.email,l.status=e.active,l.group_ids=e.groups.map(e=>e.id))}else l.email="",l.status=1,l.group_ids=[]},onConfirm:async()=>{var e;await (null===(e=a.value)||void 0===e?void 0:e.validate()),await S({emails:[l.email],group_ids:l.group_ids,status:l.status}),s.getState().refresh()}});return(e,t)=>{let s=j.Z,o=R.ZP,n=W.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(i),{title:e.$t("contacts.subscribers.edit.title"),width:"440"},{default:(0,c.w5)(()=>[(0,c._)("div",B,[(0,c.Wm)(n,{ref_key:"formRef",ref:a,model:(0,c.SU)(l),rules:r},{default:(0,c.w5)(()=>[(0,c.Wm)(o,{label:e.$t("contacts.subscribers.edit.email"),path:"email"},{default:(0,c.w5)(()=>[(0,c.Wm)(s,{value:(0,c.SU)(l).email,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(l).email=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(o,{label:e.$t("contacts.subscribers.edit.group"),path:"group_ids"},{default:(0,c.w5)(()=>[(0,c.Wm)(C,{value:(0,c.SU)(l).group_ids,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(l).group_ids=e)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}}),G={class:"w-200px"};function A(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,c.lA)(e)}let E=(0,c.aZ)({__name:"index",setup(e){let{t}=(0,x.QT)(),a=(0,d.tLD)(),{tableParams:b,tableList:_,loading:w,tableTotal:S,getTableData:U}=(0,g.Z)({loading:!0,immediate:!0,params:{page:1,page_size:10,group_id:a.value.state.group_id||"",keyword:"",status:1},fetchFn:h}),Z=(0,c.iH)([{key:"email",title:t("contacts.subscribers.columns.email"),minWidth:120,ellipsis:{tooltip:!0}},{key:"groups",title:t("contacts.subscribers.columns.name"),minWidth:100,render:e=>e.groups.map(e=>e.name).join(", ")},{key:"create_time",title:t("contacts.subscribers.columns.createdAt"),minWidth:140,render:e=>(0,v.mr)(e.create_time)},{title:t("common.columns.actions"),key:"actions",align:"right",width:180,render:e=>{let a,l;return(0,c.Wm)(p.Z,{inline:!0},{default:()=>[(0,c.Wm)(m.ZP,{type:"primary",text:!0,onClick:()=>{C(e)}},A(a=t("contacts.subscribers.actions.changeGroup"))?a:{default:()=>[a]}),(0,c.Wm)(m.ZP,{type:"error",text:!0,onClick:()=>{O(e)}},A(l=t("common.actions.delete"))?l:{default:()=>[l]})]})}}]),[W,$]=(0,f.d)({component:q,state:{refresh:U}}),j=()=>{$.setState({group_id:b.value.group_id}),$.open()},[R,z]=(0,f.d)({component:D,state:{refresh:U}}),C=e=>{z.setState({row:e}),z.open()},O=e=>{(0,v.iG)({title:t("contacts.subscribers.delete.title"),content:t("contacts.subscribers.delete.confirm",{email:e.email}),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await y({emails:[e.email],status:b.value.status}),U()}})};return(e,a)=>{let d=u.Z,p=n.Z,f=o.Z,g=s.Z,v=i.Z,h=r.Z,y=l.Z;return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.Wm)(y,null,{toolsLeft:(0,c.w5)(()=>[(0,c.Wm)((0,c.SU)(m.ZP),{type:"primary",onClick:j},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("common.actions.import")),1)]),_:1})]),toolsRight:(0,c.w5)(()=>[(0,c.Wm)(p,{value:(0,c.SU)(b).status,"onUpdate:value":[a[0]||(a[0]=e=>(0,c.SU)(b).status=e),a[1]||(a[1]=()=>(0,c.SU)(U)(!0))]},{default:(0,c.w5)(()=>[(0,c.Wm)(d,{value:1},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("contacts.subscribers.status.subscribed")),1)]),_:1}),(0,c.Wm)(d,{value:0},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("contacts.subscribers.status.unsubscribed")),1)]),_:1})]),_:1},8,["value"]),(0,c._)("div",G,[(0,c.Wm)(k,{value:(0,c.SU)(b).group_id,"onUpdate:value":[a[2]||(a[2]=e=>(0,c.SU)(b).group_id=e),a[3]||(a[3]=()=>(0,c.SU)(U)(!0))]},null,8,["value"])]),(0,c.Wm)(f,{value:(0,c.SU)(b).keyword,"onUpdate:value":a[4]||(a[4]=e=>(0,c.SU)(b).keyword=e),width:240,placeholder:(0,c.SU)(t)("contacts.subscribers.search.emailPlaceholder"),onSearch:a[5]||(a[5]=()=>(0,c.SU)(U)(!0))},null,8,["value","placeholder"])]),table:(0,c.w5)(()=>[(0,c.Wm)(v,{loading:(0,c.SU)(w),columns:(0,c.SU)(Z),data:(0,c.SU)(_)},{empty:(0,c.w5)(()=>[(0,c.Wm)(g)]),_:1},8,["loading","columns","data"])]),pageRight:(0,c.w5)(()=>[(0,c.Wm)(h,{page:(0,c.SU)(b).page,"onUpdate:page":a[6]||(a[6]=e=>(0,c.SU)(b).page=e),"page-size":(0,c.SU)(b).page_size,"onUpdate:pageSize":a[7]||(a[7]=e=>(0,c.SU)(b).page_size=e),"item-count":(0,c.SU)(S),onRefresh:(0,c.SU)(U)},null,8,["page","page-size","item-count","onRefresh"])]),modal:(0,c.w5)(()=>[(0,c.Wm)((0,c.SU)(W)),(0,c.Wm)((0,c.SU)(R))]),_:1})])}}}),Q=(0,I.default)(E,[["__scopeId","data-v-7993b7e2"]])}}]);