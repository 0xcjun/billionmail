"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["8818"],{69288:function(e,a,t){t.d(a,{DP:()=>w,Ew:()=>r,I5:()=>p,JI:()=>m,L3:()=>c,Nh:()=>y,UY:()=>g,WJ:()=>h,nn:()=>_});var l=t(77527),n=t(86244),s=t(25595);let{t:o}=l.Z.global,u={fetchOptions:{loading:o("template.ai.loading.message"),successMessage:!0}};async function i(e,a){try{await n.e.post("/email_template/create",{temp_name:a,add_type:2,chat_id:e,html_content:""})}catch(e){throw console.warn(e),e}}async function c(e){await v(e),await d(e)}async function r(e){try{let a=`AI_temp_${new Date().getTime()}`,t=await n.e.post("/askai/chat/create_chat",{domain:e,add_type:99,temp_name:a},u);return await i(t.chatId,a),t.chatId}catch(e){return console.warn(e),null}}async function v(e){let{modelList:a,currentModel:t,currentModelTitle:l}=e;try{a.value=await n.e.post("/askai/supplier/models"),a.value.length&&(t.value=a.value[0],l.value=a.value[0].title)}catch(e){console.warn(e)}}async function d(e){let{chatId:a,chatInfo:t,currentModel:l,modelList:s,currentModelTitle:o,chatRecord:u,usageRecord:i}=e;try{if(t.value=await n.e.post("/askai/chat/info",{chatId:a.value}),t.value.modelId&&s.value.length){let e=s.value.find(e=>e.modelId==t.value.modelId);e&&(l.value=e,o.value=e.title)}for(let e=0;e<t.value.messages.length;e++){let a=`${t.value.messages[e].content}_+_${u.value.size}`;"user"==t.value.messages[e].role&&(u.value.set(a,f(t.value.messages[e+1].content)),i.value.set(a,t.value.messages[e+1].usage))}}catch(e){console.warn(e)}}async function p(e){let{chatId:a,isChat:t}=e;try{await n.e.post("/askai/chat/stop",{chatId:a.value},u),t.value=!1}catch(e){console.warn(e)}}async function h(e,a){let{scrollable:t,generateShow:l,chatId:o,currentModel:u,questionContent:i,chatRecord:c,currentChatRecordKey:r,scrollWrapperRef:v,chatScrollRef:d,isChat:p,usageRecord:h}=e;if(p.value||!i.value||a&&function(e,a){if(e.shiftKey&&"Enter"===e.key){e.preventDefault();let t=e.target,l=t.selectionStart,n=t.selectionEnd;return a.value=a.value.substring(0,l)+"\n"+a.value.substring(n),t.selectionStart=t.selectionEnd=l+1,!0}}(a,i))return;let m=`${i.value}_+_${c.value.size}`;c.value.set(m,[]),r.value=m;let g=i.value;i.value="";let w=[],_="",I=0;try{t.value=!0,l.value=!0,p.value=!0,(0,s.Y3)(()=>d.value.scrollTo({left:0,top:v.value.offsetHeight})),await n.e.post("/askai/chat/chat",{chatId:o.value,supplierName:u.value.supplierName,modelId:u.value.modelId,content:g,is_text:"false"},{fetchOptions:{cancelResInterceptor:!0},responseType:"text",onDownloadProgress:e=>{l.value=!1;try{let l=e.event.target.responseText,n=l.slice(I);I=l.length;var a=function(e){let a=e.split("\n"),t=[];for(let e of a){let a=e.trim();if(a.startsWith("data:")){let e=a.slice(5).trim();e&&t.push(e)}}return t}(n);for(let e=0;e<a.length;e++)a[e]&&(_+=JSON.parse(a[e]).content);c.value.set(m,f(_)),t.value&&setTimeout(()=>d.value.scrollTo({left:0,top:v.value.offsetHeight}),200)}catch(e){console.warn(e)}}}),t.value=!0,d.value.scrollTo({left:0,top:v.value.offsetHeight}),p.value=!1,y(e,e=>{h.value.set(m,e)})}catch(e){console.warn(e)}finally{l.value=!1,_="",I=0}}function f(e){let a=/```[\s\S]*?(?:```|$)/g,t=e.match(a)||[],l=e.split(a),n=[],s=Math.max(l.length,t.length);for(let e=0;e<s;e++)e<l.length&&""!==l[e].trim()&&n.push(l[e]),e<t.length&&n.push(t[e]);return n}function m(e){return e.replace(/```html/g,"").replace(/```$/gm,"")}function g(e){return e.replace(/<<<<<<<\s+SEARCH[\s\S]*?=======([\s\S]*?)>>>>>>>\s+REPLACE/g,"$1")}function w(e){let a=e.match(/<title>(.*?)<\/title>/i);return a?a[1]:""}async function y(e,a){let{chatId:t,previewCode:l,previewTit:s}=e;try{let e=await n.e.post("/askai/chat/get_html",{chatId:t.value});l.value=e.html_content,s.value=w(l.value),a&&a(e.last_usage)}catch(e){console.warn(e)}}async function _(e){let{previewCode:a,chatId:t}=e;try{await n.e.post("/askai/chat/modify_html",{chatId:t.value,content:a.value},u),y(e)}catch(e){console.warn(e)}}},20290:function(e,a,t){t.d(a,{Z:()=>y});var l=t(24950),n=t(99833),s=t(46126),o=t(25595),u=t(86244),i=t(69288),c=t(86695),r=t(29938);let v={class:"wrapper"},d={class:"creation-methods"},p=["onClick"],h={class:"item-label"},f={class:"label"},m={class:"desc"},g={class:"flex justify-end"},w=(0,o.aZ)({__name:"CreateTplModal",props:{onlyAi:{type:Boolean}},emits:["confirmType","hasCreateTpl"],setup(e,a){let{expose:t,emit:w}=a,y=(0,c.s6)(),_=(0,r.tv)(),I=(0,o.iH)(["Drag","AI","HTML"]),S=(0,o.iH)("AI"),k=(0,o.iH)(""),T=(0,o.iH)(!1),b=(0,o.iH)([]),A=(0,o.Fl)(()=>e.onlyAi?["AI"]:I.value),U=(0,o.Fl)(()=>b.value.filter(e=>1==e.hasbrandinfo)),C=(0,o.Fl)(()=>"AI"==S.value&&0==b.value.length);async function H(){if("AI"==S.value){let e=await (0,i.Ew)(k.value);e&&(y.domainSource=k.value,_.push({name:"ai-template",params:{chatId:e}}))}else w("confirmType",S.value)}async function $(){if(b.value=(await u.e.get("/domains/list",{params:{page:1,page_size:100}})).list,0==b.value.length){y.domainSource="",k.value="";return}y.domainSource?k.value=y.domainSource:(k.value=b.value[0].domain,y.domainSource=b.value[0].domain)}return t({open:function(){$(),y.domainSource&&(y.domainSource=k.value),T.value=!0},close:function(){T.value=!1}}),(e,a)=>{let t=s.Z,u=n.ZP,i=l.Z;return(0,o.wg)(),(0,o.j4)(i,{show:(0,o.SU)(T),"onUpdate:show":a[1]||(a[1]=e=>(0,o.dq)(T)?T.value=e:null),preset:"card",draggable:"","close-on-esc":!1,"mask-closable":!1,segmented:"",class:"w-110",title:""},{footer:(0,o.w5)(()=>[(0,o._)("div",g,[(0,o.Wm)(u,{type:"primary",disabled:(0,o.SU)(C),onClick:H},{default:(0,o.w5)(()=>[(0,o.Uk)((0,o.zw)(e.$t("template.createTpl.create")),1)]),_:1},8,["disabled"])])]),default:(0,o.w5)(()=>[(0,o._)("div",v,[(0,o._)("div",d,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,o.SU)(A),(e,a)=>((0,o.wg)(),(0,o.iD)("div",{key:a,class:(0,o.C_)(["choose-item",{active:(0,o.SU)(S)==e}]),onClick:a=>S.value=e},[(0,o._)("span",h,(0,o.zw)(e),1)],10,p))),128))]),(0,o._)("div",{class:(0,o.C_)(["url-source",{hidden:"AI"!==(0,o.SU)(S)}])},[(0,o._)("span",f,(0,o.zw)(e.$t("template.createTpl.sourceUrl")),1),(0,o.Wm)(t,{value:(0,o.SU)(k),"onUpdate:value":a[0]||(a[0]=e=>(0,o.dq)(k)?k.value=e:null),class:"flex-1","label-field":"domain","value-field":"domain",options:(0,o.SU)(U),disabled:""},null,8,["value","options"])],2),(0,o._)("div",m,(0,o.zw)(e.$t("template.createTpl.useAiTools")),1)])]),_:1},8,["show"])}}}),y=(0,t(83744).default)(w,[["__scopeId","data-v-97541b98"]])}}]);