"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["108"],{69288:function(e,a,t){t.d(a,{DP:()=>g,Ew:()=>r,I5:()=>d,JI:()=>m,L3:()=>i,Nh:()=>y,UY:()=>w,WJ:()=>h,nn:()=>_});var l=t(77527),n=t(86244),s=t(25595);let{t:o}=l.Z.global,c={fetchOptions:{loading:o("template.ai.loading.message"),successMessage:!0}};async function u(e,a){try{await n.e.post("/email_template/create",{temp_name:a,add_type:2,chat_id:e,html_content:""})}catch(e){throw console.warn(e),e}}async function i(e){await v(e),await p(e)}async function r(e){try{let a=`AI_temp_${new Date().getTime()}`,t=await n.e.post("/askai/chat/create_chat",{domain:e,add_type:99,temp_name:a},c);return await u(t.chatId,a),t.chatId}catch(e){return console.warn(e),null}}async function v(e){let{modelList:a,currentModel:t,currentModelTitle:l}=e;try{a.value=await n.e.post("/askai/supplier/models"),a.value.length&&(t.value=a.value[0],l.value=a.value[0].title)}catch(e){console.warn(e)}}async function p(e){let{chatId:a,chatInfo:t,currentModel:l,modelList:s,currentModelTitle:o,chatRecord:c}=e;try{if(t.value=await n.e.post("/askai/chat/info",{chatId:a.value}),t.value.modelId&&s.value.length){let e=s.value.find(e=>e.modelId==t.value.modelId);e&&(l.value=e,o.value=e.title)}for(let e=0;e<t.value.messages.length;e++)"user"==t.value.messages[e].role&&c.value.set(`${t.value.messages[e].content}_+_${c.value.size}`,f(t.value.messages[e+1].content))}catch(e){console.warn(e)}}async function d(e){let{chatId:a,isChat:t}=e;try{await n.e.post("/askai/chat/stop",{chatId:a.value},c),t.value=!1}catch(e){console.warn(e)}}async function h(e){let{scrollable:a,generateShow:t,chatId:l,currentModel:o,questionContent:c,chatRecord:u,currentChatRecordKey:i,scrollWrapperRef:r,chatScrollRef:v,isChat:p}=e;if(p.value||!c.value)return;let d=`${c.value}_+_${u.value.size}`;u.value.set(d,[]),i.value=d;let h=c.value;c.value="";let m=[],w="",g=0;try{a.value=!0,t.value=!0,p.value=!0,(0,s.Y3)(()=>v.value.scrollTo({left:0,top:r.value.offsetHeight})),await n.e.post("/askai/chat/chat",{chatId:l.value,supplierName:o.value.supplierName,modelId:o.value.modelId,content:h,is_text:"false"},{fetchOptions:{cancelResInterceptor:!0},responseType:"text",onDownloadProgress:e=>{t.value=!1;try{let t=e.event.target.responseText,n=t.slice(g);g=t.length;var l=function(e){let a=e.split("\n"),t=[];for(let e of a){let a=e.trim();if(a.startsWith("data:")){let e=a.slice(5).trim();e&&t.push(e)}}return t}(n);for(let e=0;e<l.length;e++)l[e]&&(w+=JSON.parse(l[e]).content);u.value.set(d,f(w)),a.value&&setTimeout(()=>v.value.scrollTo({left:0,top:r.value.offsetHeight}),200)}catch(e){console.warn(e)}}}),a.value=!0,v.value.scrollTo({left:0,top:r.value.offsetHeight}),p.value=!1,y(e)}catch(e){console.warn(e)}finally{t.value=!1,w="",g=0}}function f(e){let a=/```[\s\S]*?(?:```|$)/g,t=e.match(a)||[],l=e.split(a),n=[],s=Math.max(l.length,t.length);for(let e=0;e<s;e++)e<l.length&&""!==l[e].trim()&&n.push(l[e]),e<t.length&&n.push(t[e]);return n}function m(e){return e.replace(/```html/g,"").replace(/```$/gm,"")}function w(e){return e.replace(/<<<<<<<\s+SEARCH[\s\S]*?=======([\s\S]*?)>>>>>>>\s+REPLACE/g,"$1")}function g(e){let a=e.match(/<title>(.*?)<\/title>/i);return a?a[1]:""}async function y(e){let{chatId:a,previewCode:t,previewTit:l}=e;try{t.value=await n.e.post("/askai/chat/get_html",{chatId:a.value}),l.value=g(t.value)}catch(e){console.warn(e)}}async function _(e){let{previewCode:a,chatId:t}=e;try{await n.e.post("/askai/chat/modify_html",{chatId:t.value,content:a.value},c)}catch(e){console.warn(e)}}},9412:function(e,a,t){t.d(a,{Z:()=>w});var l=t(24950),n=t(99833),s=t(46126),o=t(25595),c=t(86244),u=t(69288),i=t(86695),r=t(29938);let v={class:"wrapper"},p={class:"creation-methods"},d=["onClick"],h={class:"item-label"},f={class:"flex justify-end"},m=(0,o.aZ)({__name:"CreateTplModal",props:{onlyAi:{type:Boolean}},emits:["confirmType","hasCreateTpl"],setup(e,a){let{expose:t,emit:m}=a,w=(0,i.s6)(),g=(0,r.tv)(),y=(0,o.iH)(["Drag","AI","HTML"]),_=(0,o.iH)("AI"),I=(0,o.iH)(""),k=(0,o.iH)(!1),S=(0,o.iH)([]),C=(0,o.Fl)(()=>e.onlyAi?["AI"]:y.value);async function T(){if("AI"==_.value){let e=await (0,u.Ew)(I.value);e&&(w.domainSource=I.value,g.push({name:"ai-template",params:{chatId:e}}))}else m("confirmType",_.value)}return t({open:function(){w.domainSource&&(w.domainSource=I.value),k.value=!0},close:function(){k.value=!1}}),async function(){S.value=(await c.e.get("/domains/list",{params:{page:1,page_size:100}})).list,w.domainSource?I.value=w.domainSource:I.value=S.value[0].domain}(),(e,a)=>{let t=s.Z,c=n.ZP,u=l.Z;return(0,o.wg)(),(0,o.j4)(u,{show:(0,o.SU)(k),"onUpdate:show":a[1]||(a[1]=e=>(0,o.dq)(k)?k.value=e:null),preset:"card",draggable:"","close-on-esc":!1,"mask-closable":!1,segmented:"",class:"w-110",title:""},{footer:(0,o.w5)(()=>[(0,o._)("div",f,[(0,o.Wm)(c,{type:"primary",onClick:T},{default:(0,o.w5)(()=>a[4]||(a[4]=[(0,o.Uk)("Create")])),_:1,__:[4]})])]),default:(0,o.w5)(()=>[(0,o._)("div",v,[(0,o._)("div",p,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,o.SU)(C),(e,a)=>((0,o.wg)(),(0,o.iD)("div",{key:a,class:(0,o.C_)(["choose-item",{active:(0,o.SU)(_)==e}]),onClick:a=>_.value=e},[(0,o._)("span",h,(0,o.zw)(e),1)],10,d))),128))]),(0,o._)("div",{class:(0,o.C_)(["url-source",{hidden:"AI"!==(0,o.SU)(_)}])},[a[2]||(a[2]=(0,o._)("span",{class:"label"},"Source Url",-1)),(0,o.Wm)(t,{value:(0,o.SU)(I),"onUpdate:value":a[0]||(a[0]=e=>(0,o.dq)(I)?I.value=e:null),class:"flex-1","label-field":"domain","value-field":"domain",options:(0,o.SU)(S)},null,8,["value","options"])],2),a[3]||(a[3]=(0,o._)("div",{class:"desc"}," Use AI tools to help you automatically generate email content and improve your work efficiency. ",-1))])]),_:1},8,["show"])}}}),w=(0,t(83744).default)(m,[["__scopeId","data-v-0f1301b0"]])}}]);